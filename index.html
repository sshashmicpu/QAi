<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QAi - Ø¢Ù¾ Ú©Ø§ Ø°ÛÛŒÙ† Ø§ÙˆØ± ØªØ®Ù„ÛŒÙ‚ÛŒ Ù…Ø¹Ø§ÙˆÙ†</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Amiri -->
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="manifest" href="manifest.json">

<meta name="theme-color" content="#6200ee">

<link rel="apple-touch-icon" href="icon.png">

    <style>
        /* Base styles for the body and overall container */
        html {
            font-size: 16px; /* Base font size for rem units */
        }
        body {
            font-family: 'Amiri', serif;
            background: linear-gradient(135deg, #1a1a2e, #0f0f1a);
            color: #e0e0e0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            transition: background-color 0.5s ease; /* Smooth transition for theme change */
        }

        /* Light theme styles */
        body.light-theme {
            background: linear-gradient(135deg, #f0f0f0, #ffffff);
            color: #1a1a2e;
        }
        body.light-theme .chat-container {
            background-color: #ffffff;
            border-color: #d0d0d0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        body.light-theme .chat-header {
            background: linear-gradient(90deg, #6a0dad, #8a2be2); /* Futuristic purple gradient */
            border-bottom-color: #c0c0c0;
        }
        body.light-theme .chat-header h1 {
            color: #ffffff; /* White text on purple gradient */
            text-shadow: none;
        }
        body.light-theme .chat-header h1 i {
            color: #8be9fd; /* Cyan icon on purple gradient */
        }
        body.light-theme .user-message {
            background: linear-gradient(135deg, #e0e0e0, #f0f0f0);
            color: #1a1a2e;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        body.light-theme .ai-message {
            background: linear-gradient(135deg, #a0d9ff, #7ac0ff); /* Lighter blue/green */
            color: #1a1a2e;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        /* Light theme heading colors */
        body.light-theme .ai-message h1 {
            color: #FF8C00 !important; /* Orange for H1 in light theme */
        }
        body.light-theme .ai-message h2,
        body.light-theme .ai-message h3,
        body.light-theme .ai-message h4,
        body.light-theme .ai-message h5,
        body.light-theme .ai-message h6 {
            color: #007bff !important; /* Blue for subheadings in light theme */
        }
        body.light-theme .ai-message strong {
            color: #FF00FF !important; /* Pink for key points in light theme */
        }
        body.light-theme .loading-indicator p {
            color: #1a1a2e;
            text-shadow: none;
        }
        body.light-theme .chat-input-area {
            background-color: #e0e0e0;
            border-top-color: #d0d0d0;
        }
        body.light-theme .chat-input-area input {
            background-color: #e8f0fe; /* Appealing light color */
            color: #1a1a2e;
        }
        body.light-theme .chat-input-area input:focus {
            border-color: #007bff;
            box-shadow: 0 0 8px rgba(0, 123, 255, 0.3);
        }
        body.light-theme .chat-input-area .action-buttons-top button {
            background: linear-gradient(90deg, #007bff, #0056b3);
            color: #ffffff;
        }
         body.light-theme .chat-input-area .action-buttons-top button:hover {
            box-shadow: 0 5px 15px rgba(0, 123, 255, 0.4);
            background: linear-gradient(90deg, #0056b3, #007bff);
        }
        body.light-theme .chat-input-area .action-buttons-top button:disabled,
        body.light-theme .q-modes-button:disabled {
            background: #c0c0c0;
        }
        /* Q-Modes Button Light Theme */
        body.light-theme .q-modes-button {
            background: linear-gradient(90deg, #FFA500, #ff8c00) !important; /* Orange gradient */
            color: #ffffff !important;
            border: 1px solid #cc8400 !important;
        }
        body.light-theme .q-modes-button:hover {
            background: linear-gradient(90deg, #ff8c00, #ffA500) !important;
            box-shadow: 0 5px 15px rgba(255, 165, 0, 0.4) !important;
        }

        body.light-theme .feature-icons button {
            color: #1a1a2e;
            opacity: 0.8;
        }
        body.light-theme .feature-icons button:hover {
            color: #007bff;
        }
        body.light-theme .feature-icons button.active {
            color: #0056b3;
        }
        body.light-theme .chat-messages::-webkit-scrollbar-track {
            background: #f0f0f0;
        }
        body.light-theme .chat-messages::-webkit-scrollbar-thumb {
            background: #c0c0c0;
        }
        body.light-theme .chat-messages::-webkit-scrollbar-thumb:hover {
            background: #b0b0b0;
        }
        body.light-theme .modal-content {
            background-color: #f0f0f0;
            border-color: #d0d0d0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        body.light-theme .modal-content h2 {
            color: #007bff;
            text-shadow: none;
        }
        body.light-theme .modal-content p {
            color: #4B0082; /* Indigo for About text in light theme */
        }
        body.light-theme .modal-content ul {
            color: #333333;
        }
        body.light-theme .modal-close-button {
            background: linear-gradient(90deg, #dc3545, #c82333);
        }
        body.light-theme .modal-close-button:hover {
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4);
        }
        body.light-theme .sidebar {
            background-color: #f8f8f8;
            border-left-color: #e0e0e0;
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
        }
        body.light-theme .sidebar-header {
            background-color: #e0e0e0;
            border-bottom-color: #d0d0d0;
            color: #1a1a2e;
        }
        body.light-theme .sidebar-option {
            background-color: #004080; /* Dark blue for light theme sidebar options */
            color: #ffffff;
        }
        body.light-theme .sidebar-option:hover {
            background-color: #0056b3;
            color: #ffffff;
        }
        body.light-theme .sidebar-option i {
            color: #ffffff; /* White icon on dark blue */
        }
        body.light-theme .sidebar-option:hover i {
            color: #8be9fd; /* Cyan on hover */
        }
        body.light-theme .language-option.selected {
            background-color: #007bff;
            color: white;
        }
        body.light-theme .language-option:hover {
            background-color: #e0e0e0;
            color: #007bff;
        }
        body.light-theme .theme-toggle-button {
            background-color: #c0c0c0;
            color: #1a1a2e;
        }
        body.light-theme .theme-toggle-button:hover {
            background-color: #b0b0b0;
        }
        body.light-theme .suggested-questions-container {
            background-color: #f0f0f0;
            border-color: #d0d0d0;
        }
        body.light-theme .suggested-question-button {
            background-color: #e0e0e0;
            color: #1a1a2e;
            border-color: #c0c0c0;
        }
        body.light-theme .suggested-question-button:hover {
            background-color: #d0d0d0;
            color: #007bff;
        }
        body.light-theme .ai-message .message-actions button,
        body.light-theme .user-message .message-actions button {
            background-color: #e0e0e0; /* Lighter background for buttons in light theme */
            color: #0056b3; /* Darker blue for text/icon in light theme */
            border-color: #c0c0c0;
        }
        body.light-theme .ai-message .message-actions button:hover,
        body.light-theme .user-message .message-actions button:hover {
            background-color: #d0d0d0;
            color: #007bff;
        }
        body.light-theme .tone-option-button,
        body.light-theme .q-modes-option-button {
            background-color: #e0e0e0;
            color: #1a1a2e;
            border-color: #c0c0c0;
        }
        body.light-theme .tone-option-button:hover,
        body.light-theme .q-modes-option-button:hover {
            background-color: #d0d0d0;
            color: #007bff;
        }
        body.light-theme .tone-option-button.selected {
            background-color: #007bff;
            color: white;
            border-color: #0056b3;
        }
        body.light-theme .q-modes-option-button.selected {
            background-color: #007bff;
            color: white;
        }
        body.light-theme .image-preview-container {
            background-color: #e8f0fe;
            border-color: #d0d0d0;
        }
        body.light-theme .image-preview-container span {
            color: #1a1a2e;
        }
        body.light-theme .ui-language-toggle-button {
            background-color: rgba(255, 255, 255, 0.2);
            color: #1a1a2e;
        }
        body.light-theme .ui-language-toggle-button:hover {
             background-color: rgba(255, 255, 255, 0.3);
        }


        /* Main chat container styling */
        .chat-container {
            background-color: #2a2a4a;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            width: 100%;
            max-width: 800px;
            height: 90vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 2px solid #4a4a6a;
            animation: proWelcome 0.8s ease-out forwards; /* Pro welcome animation */
            position: relative; /* For absolute positioning of loading indicator */
        }

        /* Chat header styling */
        .chat-header {
            background: linear-gradient(90deg, #6a0dad, #8a2be2); /* Futuristic purple gradient */
            padding: 10px 20px; /* Reduced padding for smaller height */
            border-bottom: 1px solid #3a3a5a;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-top-left-radius: 18px;
            border-top-right-radius: 18px;
        }

        /* Header title styling */
        .chat-header h1 {
            font-size: 1.6rem; /* Slightly reduced font size */
            font-weight: bold;
            color: #ffffff;
            display: flex;
            align-items: center;
            letter-spacing: 1px;
            text-shadow: 0 0 5px rgba(139, 233, 253, 0.5);
            flex-grow: 1; /* Allow it to take available space */
            justify-content: center; /* Center the text */
            position: relative; /* For animation */
        }
        .chat-header h1 i {
            margin-left: 10px; /* Adjust for RTL */
            color: #8be9fd;
            animation: pulse 2s infinite ease-in-out; /* Pulse animation for icon */
        }
        .chat-header .qai-name-header {
            font-size: 2rem; /* Larger font size for QAi name in header */
            font-weight: bold;
            color: #50fa7b; /* Bright green */
            text-shadow: 0 0 10px rgba(80, 250, 123, 0.7);
            animation: pulse-qai 2s infinite ease-in-out; /* New animation for QAi name */
        }


        /* Status bar buttons */
        .status-bar-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .status-bar-buttons button, .ui-language-toggle-button { /* Added ui-language-toggle-button */
            background: none;
            border: none;
            color: #e0e0e0;
            font-size: 1rem; /* Smaller font size for status bar buttons */
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.2s ease, color 0.2s ease, transform 0.2s ease, background-color 0.2s ease;
            padding: 5px 8px; /* Smaller padding */
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .status-bar-buttons button:hover, .ui-language-toggle-button:hover { /* Added ui-language-toggle-button */
            opacity: 1;
            color: #8be9fd;
            transform: scale(1.05);
            background-color: rgba(255, 255, 255, 0.1);
        }
        .ui-language-toggle-button {
            font-weight: bold;
            padding: 5px 10px;
        }
        /* New Q-Modes shortcut button animation */
        #qModesShortcutStatusBarButton {
            color: #FFA500; /* Orange color */
            animation: pulse-orange 2.5s infinite ease-in-out;
        }
        body.light-theme #qModesShortcutStatusBarButton {
             color: #ff8c00;
        }


        /* Chat messages area */
        .chat-messages {
            flex-grow: 1;
            padding: 20px;
            padding-bottom: 180px; /* Increased padding for new chat input area layout + margin */
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
            scroll-behavior: smooth;
            background: linear-gradient(45deg, #2a2a4a, #1a1a2e, #0f0f1a); /* Animated background */
            background-size: 400% 400%;
            animation: gradientAnimation 15s ease infinite;
            position: relative; /* Crucial for absolute positioning of loading-indicator */
        }
        body.light-theme .chat-messages {
            background: linear-gradient(45deg, #f0f0f0, #ffffff, #f8f8f8);
            background-size: 400% 400%;
            animation: gradientAnimation 15s ease infinite;
        }


        /* Individual message styling */
        .message {
            max-width: 75%; /* Slightly reduced width as requested */
            padding: 12px 18px;
            border-radius: 15px;
            word-wrap: break-word;
            animation: fadeIn 0.5s ease-out forwards;
            opacity: 0; /* Start hidden for animation */
        }
        /* Staggered animation for initial messages */
        .suggested-questions-container { animation-delay: 0.5s; }
        .message.initial-welcome { animation-delay: 0.7s; }

        .user-message {
            background: linear-gradient(135deg, #6a6a8a, #8a8a9a); /* User message gradient */
            align-self: flex-start; /* For RTL, user messages are on the right */
            color: #ffffff;
            border-bottom-left-radius: 0;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        body.light-theme .user-message {
            background: linear-gradient(135deg, #e0e0e0, #f0f0f0);
            color: #1a1a2e;
        }
        .ai-message {
            background: linear-gradient(135deg, #8be9fd, #50fa7b);
            align-self: flex-end; /* For RTL, AI messages are on the left */
            color: #1a1a2e;
            border-bottom-right-radius: 0;
        }
        .message img {
            max-width: 100%;
            border-radius: 10px;
            margin-top: 10px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        .message p {
            margin-bottom: 0; /* No blank lines at the end of messages */
        }
        /* Headings and strong tags styling */
        .ai-message h1 {
            font-weight: bold;
            margin-top: 10px;
            margin-bottom: 5px;
            color: #FF8C00 !important; /* Orange for H1 */
        }
        .ai-message h2, .ai-message h3, .ai-message h4, .ai-message h5, .ai-message h6 {
            font-weight: bold;
            margin-top: 10px;
            margin-bottom: 5px;
            color: #007bff !important; /* Blue for subheadings */
        }
        .ai-message strong {
            color: #FF00FF !important; /* Pink for key points */
            font-weight: bold;
        }

        .message ul, .message ol {
            padding-right: 20px; /* For RTL lists */
            margin-bottom: 0; /* No blank lines at the end of messages */
        }
        .message table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            margin-bottom: 0; /* No blank lines at the end of messages */
            background-color: rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden; /* For rounded corners */
        }
        .message th, .message td {
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 8px;
            text-align: right; /* For RTL tables */
        }
        .message th {
            background-color: rgba(0, 0, 0, 0.2);
            font-weight: bold;
        }
        .message .message-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            justify-content: flex-end; /* Align actions to the left for AI messages */
            flex-wrap: wrap;
        }
        .message-actions button {
            background-color: #1f3a5f; /* Darker blue background for buttons */
            color: #8be9fd; /* Cyan text/icon color for buttons */
            border: 1px solid #4a4a6a;
            padding: 6px 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: background-color 0.2s ease, transform 0.2s ease, color 0.2s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .message-actions button:hover {
            background-color: #2a4c7a;
            transform: translateY(-1px);
            color: #FFD700; /* Gold on hover */
        }
        .message-actions button:active {
            transform: translateY(0);
        }

        /* --- NEW Quantum Atom Loading Indicator --- */
        .loading-indicator {
            align-self: flex-end;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            padding: 15px;
            max-width: 75%;
            animation: fadeIn 0.5s ease-out forwards;
        }
        .quantum-atom {
            position: relative;
            width: 80px;
            height: 80px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .quantum-atom .nucleus {
            width: 20px;
            height: 20px;
            background-color: #50fa7b;
            border-radius: 50%;
            box-shadow: 0 0 10px #50fa7b, 0 0 20px #50fa7b;
            position: absolute;
        }
        body.light-theme .quantum-atom .nucleus {
            background-color: #007bff;
            box-shadow: 0 0 10px #007bff, 0 0 20px #007bff;
        }
        .quantum-atom .electron-path {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 2px solid rgba(139, 233, 253, 0.5);
            border-radius: 50%;
            animation: rotate 4s linear infinite;
        }
        .quantum-atom .electron {
            position: absolute;
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 10px;
            height: 10px;
            background-color: #8be9fd;
            border-radius: 50%;
            box-shadow: 0 0 8px #8be9fd;
        }
        body.light-theme .quantum-atom .electron {
            background-color: #ff8c00;
             box-shadow: 0 0 8px #ff8c00;
        }
        .electron-path:nth-child(2) { animation-duration: 3s; transform: rotate(60deg); }
        .electron-path:nth-child(3) { animation-duration: 2s; transform: rotate(120deg); }
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        /* --- END NEW Loading Indicator --- */

        .loading-indicator p {
            color: #e0e0e0;
            font-weight: bold;
            text-shadow: 0 0 3px rgba(139, 233, 253, 0.5);
        }
        .loading-indicator p .dots {
            display: inline-block;
            width: 20px; /* Adjust width as needed */
            text-align: left;
        }
        .loading-indicator p .dots::after {
            display: inline-block;
            animation: loading-dots 1.5s steps(4, end) infinite;
            content: "";
        }
        @keyframes loading-dots {
          0% { content: ''; }
          25% { content: '.'; }
          50% { content: '..'; }
          75% { content: '...'; }
          100% { content: '...'; }
        }


        /* New Chat Input Area */
        .chat-input-area {
            position: absolute;
            bottom: 60px; /* Above the bottom status bar */
            left: 0;
            right: 0;
            background-color: #2a2a4a;
            padding: 15px 20px;
            border-top: 1px solid #4a4a6a;
            display: flex;
            flex-direction: column;
            gap: 10px;
            box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.5);
            z-index: 999;
            border-top-left-radius: 18px;
            border-top-right-radius: 18px;
        }
        .chat-input-area .action-buttons-top {
            display: flex;
            gap: 10px;
            justify-content: flex-start; /* Align buttons to the right for RTL */
            width: 100%; /* Take full width */
            margin-bottom: 10px; /* Space between buttons and input */
            align-items: center; /* Vertically align buttons */
        }
        .chat-input-area input {
            flex-grow: 1;
            padding: 12px 15px;
            border-radius: 10px;
            border: 1px solid #5a5a7a;
            background-color: #3f3f6f;
            color: #e0e0e0;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease;
            width: 100%; /* Take full width below buttons */
        }
        .chat-input-area input:focus {
            border-color: #8be9fd;
            box-shadow: 0 0 8px rgba(139, 233, 253, 0.6);
        }
        .chat-input-area .action-buttons-top button {
            background: linear-gradient(90deg, #8be9fd, #50fa7b);
            color: #1a1a2e;
            border: none;
            padding: 12px 15px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.3s ease;
        }
         .chat-input-area .action-buttons-top button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(139, 233, 253, 0.4);
            background: linear-gradient(90deg, #50fa7b, #8be9fd);
        }
        .chat-input-area .action-buttons-top button:disabled,
        .chat-input-area .q-modes-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background: #5a5a7a;
            box-shadow: none;
            transform: none;
        }
        .chat-input-area .image-attach-button {
            background-color: #3a3a5a;
            color: #FFD700;
            border: 1px solid #4a4a6a;
            padding: 12px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s ease, transform 0.2s ease;
        }
        .chat-input-area .image-attach-button:hover {
            background-color: #4a4a6a;
            transform: translateY(-2px);
        }
        .q-modes-button {
            background: linear-gradient(90deg, #FFA500, #ff8c00) !important; /* Orange gradient */
            color: #ffffff !important;
            border: 1px solid #cc8400 !important;
            padding: 12px 15px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.3s ease;
        }
        .q-modes-button:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 5px 15px rgba(255, 165, 0, 0.4) !important;
            background: linear-gradient(90deg, #ff8c00, #ffA500) !important;
        }


        /* More Options (Hamburger) button */
        .more-options-button {
            background: none;
            border: none;
            color: #e0e0e0;
            font-size: 1.5rem;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.2s ease, color 0.2s ease, transform 0.2s ease;
        }
        .more-options-button:hover {
            opacity: 1;
            color: #8be9fd;
            transform: scale(1.1);
        }

        /* Scrollbar Styling */
        .chat-messages::-webkit-scrollbar {
            width: 8px;
        }
        .chat-messages::-webkit-scrollbar-track {
            background: #2a2a4a;
            border-radius: 10px;
        }
        .chat-messages::-webkit-scrollbar-thumb {
            background: #4a4a6a;
            border-radius: 10px;
            transition: background 0.3s ease;
        }
        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: #6a6a8a;
        }

        /* Modal for About section and messages */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal.show {
            opacity: 1;
            visibility: visible;
            display: flex; /* Ensure it's flex when shown */
        }
        .modal-content {
            background-color: #2a2a4a;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
            max-width: 500px;
            width: 90%;
            text-align: center;
            position: relative;
            animation: zoomIn 0.3s ease-out;
            border: 2px solid #4a4a6a;
            max-height: 80vh; /* Make modal content scrollable */
            overflow-y: auto;
        }
        .modal-content h2 {
            font-size: 2rem;
            color: #8be9fd;
            margin-bottom: 15px;
            text-shadow: 0 0 5px rgba(139, 233, 253, 0.3);
        }
        .modal-content p {
            font-size: 1.1rem;
            line-height: 1.6;
            color: #9370DB; /* Medium Purple for About text */
            margin-bottom: 20px;
            text-align: right; /* Align text to right for RTL */
        }
        body.light-theme .modal-content p {
            color: #4B0082; /* Indigo for About text in light theme */
        }
        .modal-content ul {
            list-style: disc;
            padding-right: 20px; /* Adjust for RTL list bullets */
            margin-bottom: 20px;
            text-align: right;
            color: #c0c0c0;
        }
        body.light-theme .modal-content ul {
            color: #333333;
        }
        .modal-close-button {
            background: linear-gradient(90deg, #ff6b6b, #ee5253);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .modal-close-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        /* Sidebar (More Options Menu) */
        .sidebar {
            position: fixed;
            top: 0;
            right: 0; /* Position on the right for RTL */
            height: 100%;
            width: 280px;
            background-color: #20203a;
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.5); /* Shadow on the left */
            transform: translateX(100%); /* Hidden by default */
            transition: transform 0.3s ease-in-out;
            z-index: 1001; /* Above modal if needed, but usually modals are on top */
            display: flex;
            flex-direction: column;
            border-left: 2px solid #4a4a6a; /* Border on the left */
        }
        .sidebar.show {
            transform: translateX(0); /* Show sidebar */
        }
        .sidebar-header {
            background-color: #3a3a5a;
            padding: 15px 20px;
            font-size: 1.5rem;
            font-weight: bold;
            color: #8be9fd;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #4a4a6a;
        }
        .sidebar-header i {
            margin-left: 10px; /* Adjust for RTL */
        }
        .sidebar-close-button {
            background: none;
            border: none;
            color: #e0e0e0;
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.2s ease;
        }
        .sidebar-close-button:hover {
            color: #ff6b6b;
        }
        .sidebar-options {
            flex-grow: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            overflow-y: auto; /* Make options scrollable */
        }
        .sidebar-option {
            background-color: #1f3a5f; /* Darker blue for sidebar options */
            color: #8be9fd; /* Cyan text for visibility */
            padding: 12px 15px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: background-color 0.2s ease, color 0.2s ease, transform 0.2s ease;
            font-size: 1.1rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            text-align: right; /* Align text to right for RTL */
            flex-wrap: wrap; /* Allow wrapping for controls */
        }
        .sidebar-option:hover {
            background-color: #2a4c7a;
            color: #FFD700; /* Gold on hover */
            transform: translateX(-5px); /* Slide slightly on hover for RTL */
        }
        .sidebar-option i {
            font-size: 1.3rem;
            color: #8be9fd; /* Cyan icon */
            margin-left: auto; /* Push icon to the left for RTL */
        }
        .sidebar-option:hover i {
            color: #FFD700; /* Gold on hover */
        }

        /* Language selection in sidebar */
        .language-options-container {
            display: flex;
            gap: 8px;
            margin-right: auto;
        }
        .language-option {
            background-color: #4a4a6a;
            color: #e0e0e0;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.2s ease, color 0.2s ease;
            border: 1px solid transparent;
        }
        .language-option.selected {
            background-color: #50fa7b;
            color: #1a1a2e;
            font-weight: bold;
            border-color: #8be9fd;
        }
        .language-option:hover:not(.selected) {
            background-color: #6a6a8a;
        }
        

        /* Theme Toggle Button */
        .theme-toggle-button {
            background-color: #4a4a6a;
            color: #e0e0e0;
            padding: 12px 15px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: background-color 0.2s ease, color 0.2s ease, transform 0.2s ease;
            font-size: 1.1rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            text-align: right;
            justify-content: flex-end; /* Align text to right for RTL */
        }
        .theme-toggle-button:hover {
            background-color: #6a6a8a;
            color: #8be9fd;
            transform: translateX(-5px);
        }
        .theme-toggle-button i {
            font-size: 1.3rem;
            color: #50fa7b;
            margin-left: auto;
        }
        .theme-toggle-button:hover i {
            color: #8be9fd;
        }

        /* Suggested Questions */
        .suggested-questions-container {
            background-color: #2a2a4a;
            border-radius: 15px;
            padding: 15px;
            margin-top: 20px;
            border: 1px solid #4a4a6a;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            text-align: right; /* For RTL */
        }
        .suggested-questions-container h3 {
            font-size: 1.3rem;
            color: #8be9fd;
            margin-bottom: 10px;
            font-weight: bold;
        }
        .suggested-questions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
        }
        .suggested-question-button {
            background-color: #3a3a5a;
            color: #e0e0e0;
            border: 1px solid #5a5a7a;
            padding: 10px 15px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.95rem;
            text-align: right; /* For RTL */
            transition: background-color 0.2s ease, border-color 0.2s ease, transform 0.2s ease;
        }
        .suggested-question-button:hover {
            background-color: #4a4a6a;
            border-color: #8be9fd;
            transform: translateY(-2px);
        }

        /* Bottom Status Bar */
        .bottom-status-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 60px; /* Height of the status bar */
            background: linear-gradient(90deg, #1a1a2e, #0f0f1a);
            color: #8be9fd;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1rem;
            font-weight: bold;
            border-top: 1px solid #4a4a6a;
            box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.5);
            z-index: 1000; /* Above everything else */
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            padding: 0 20px;
            box-sizing: border-box;
        }
        body.light-theme .bottom-status-bar {
            background: linear-gradient(90deg, #6a0dad, #8a2be2);
            color: #ffffff;
            border-top-color: #c0c0c0;
            box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.1);
        }
        .bottom-status-bar .status-text {
            font-size: 1rem; /* Smaller font size for QAi name */
            font-weight: normal;
            color: #8be9fd;
            text-shadow: none;
            animation: none;
        }

        /* Tone Option & Q-Modes Option Buttons */
        .tone-option-button, .q-modes-option-button {
            background-color: #3a3a5a;
            color: #e0e0e0;
            border: 1px solid #5a5a7a;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.2s ease, border-color 0.2s ease, transform 0.2s ease;
            min-width: 100px; /* Ensure a minimum width for small boxes */
            text-align: center;
        }
        .tone-option-button:hover, .q-modes-option-button:hover {
            background-color: #4a4a6a;
            border-color: #8be9fd;
            transform: translateY(-2px);
        }
        .q-modes-option-button.selected {
            background-color: #50fa7b;
            color: #1a1a2e;
            font-weight: bold;
        }
        .tone-option-button.selected {
            background-color: #50fa7b; /* Bright green for selected tone */
            color: #1a1a2e; /* Dark text for contrast */
            font-weight: bold;
            border-color: #8be9fd; /* Cyan border for emphasis */
        }


        /* Image preview in chat input area */
        .image-preview-container {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            background-color: #3f3f6f;
            border-radius: 8px;
            border: 1px solid #5a5a7a;
        }
        .image-preview-container img {
            width: 40px;
            height: 40px;
            border-radius: 5px;
            object-fit: cover;
        }
        .image-preview-container span {
            color: #e0e0e0;
            font-size: 0.9rem;
        }
        .image-preview-container .remove-image-button {
            background: none;
            border: none;
            color: #ff6b6b;
            font-size: 1.2rem;
            cursor: pointer;
            margin-right: auto; /* Push to the left for RTL */
        }
        body.light-theme .image-preview-container {
            background-color: #e8f0fe;
            border-color: #d0d0d0;
        }
        body.light-theme .image-preview-container span {
            color: #1a1a2e;
        }

        /* Scroll Arrows */
        .scroll-arrow {
            position: absolute;
            right: 20px; /* Align to the right for RTL */
            width: 50px;
            height: 50px;
            background-color: rgba(60, 60, 90, 0.8);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.8rem;
            color: #8be9fd;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            z-index: 998; /* Below chat input area, above messages */
            opacity: 0;
            visibility: hidden;
        }
        .scroll-arrow:hover {
            background-color: rgba(80, 80, 110, 0.9);
            transform: translateY(-5px) scale(1.05);
            color: #50fa7b;
        }
        .scroll-arrow.show {
            opacity: 1;
            visibility: visible;
        }
        #scrollToTopArrow {
            top: 80px; /* Position below header */
        }
        #scrollToBottomArrow {
            bottom: 200px; /* Position above chat input area */
        }
        body.light-theme .scroll-arrow {
            background-color: rgba(200, 200, 200, 0.8);
            color: #007bff;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        body.light-theme .scroll-arrow:hover {
            background-color: rgba(180, 180, 180, 0.9);
            color: #0056b3;
        }


        /* Animations */
        @keyframes proWelcome {
            from { transform: translateY(30px) scale(0.98); opacity: 0; }
            to { transform: translateY(0) scale(1); opacity: 1; }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulse {
            0% { transform: scale(1); text-shadow: 0 0 5px rgba(139, 233, 253, 0.5); }
            50% { transform: scale(1.05); text-shadow: 0 0 15px rgba(139, 233, 253, 0.8); }
            100% { transform: scale(1); text-shadow: 0 0 5px rgba(139, 233, 253, 0.5); }
        }
        @keyframes pulse-qai {
            0% { transform: scale(1); text-shadow: 0 0 10px rgba(80, 250, 123, 0.7); }
            50% { transform: scale(1.08); text-shadow: 0 0 20px rgba(80, 250, 123, 0.9); }
            100% { transform: scale(1); text-shadow: 0 0 10px rgba(80, 250, 123, 0.7); }
        }
         @keyframes pulse-orange {
            0% { transform: scale(1); text-shadow: 0 0 4px rgba(255, 165, 0, 0.6); }
            50% { transform: scale(1.1); text-shadow: 0 0 12px rgba(255, 165, 0, 0.9); }
            100% { transform: scale(1); text-shadow: 0 0 4px rgba(255, 165, 0, 0.6); }
        }
        @keyframes zoomIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        @keyframes gradientAnimation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Media Queries for Responsiveness */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            .chat-container {
                height: 98vh; /* Slightly taller on mobile */
                border-radius: 15px;
            }
            .chat-header {
                padding: 8px 15px;
            }
            .chat-header h1 {
                font-size: 1.4rem;
            }
            .chat-header .qai-name-header {
                font-size: 1.8rem; /* Smaller QAi name on mobile */
            }
            .more-options-button {
                font-size: 1.2rem;
            }
            .chat-messages {
                padding: 15px;
                padding-bottom: 180px; /* Adjusted for mobile chat input area */
                gap: 10px;
            }
            .message {
                padding: 10px 15px;
                max-width: 90%; /* Wider message boxes on mobile */
            }
            .chat-input-area {
                padding: 10px 15px;
            }
            .chat-input-area input {
                font-size: 0.9rem;
            }
            .chat-input-area .action-buttons-top button,
            .chat-input-area .q-modes-button {
                padding: 10px 12px; /* Adjusted padding for mobile */
                font-size: 0.9rem;
            }
            .modal-content {
                padding: 20px;
            }
            .modal-content h2 {
                font-size: 1.6rem;
            }
            .modal-content p {
                font-size: 1rem;
            }
            .sidebar {
                width: 250px;
            }
            .sidebar-header {
                font-size: 1.3rem;
            }
            .sidebar-option {
                font-size: 1rem;
            }
            .sidebar-option i {
                font-size: 1.1rem;
            }
            .suggested-questions-grid {
                grid-template-columns: 1fr; /* Stack on mobile */
            }
            .suggested-question-button {
                font-size: 0.9rem;
            }
            .status-bar-buttons {
                gap: 5px; /* Smaller gap for mobile */
            }
            .status-bar-buttons button, .ui-language-toggle-button {
                font-size: 0.8rem; /* Smaller font for mobile status bar buttons */
                padding: 3px 6px;
            }
             .ui-language-toggle-button {
                padding: 3px 8px; /* Slightly more padding for text */
            }
            .loading-indicator {
                margin-bottom: 15px; /* Adjusted higher for mobile */
            }
            .bottom-status-bar {
                height: 60px; /* Consistent height on mobile */
                font-size: 0.9rem;
            }
            .scroll-arrow {
                width: 40px;
                height: 40px;
                font-size: 1.5rem;
                right: 10px;
            }
            #scrollToTopArrow {
                top: 70px;
            }
            #scrollToBottomArrow {
                bottom: 190px;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <div class="status-bar-buttons">
                <button id="themeToggleStatusBarButton" title="ØªÚ¾ÛŒÙ… ØªØ¨Ø¯ÛŒÙ„ Ú©Ø±ÛŒÚº" type="button">
                    <i class="fas fa-moon"></i>
                </button>
                <button id="qModesShortcutStatusBarButton" title="Ø¬ÙˆØ§Ø¨ÛŒ Ù…ÙˆÚˆ" type="button">
                    <i class="fas fa-brain"></i>
                </button>
                <button id="toneShortcutStatusBarButton" title="Ø¬ÙˆØ§Ø¨ Ú©Ø§ Ø§Ù†Ø¯Ø§Ø²" type="button">
                    <i class="fas fa-palette"></i>
                </button>
                <button id="uiLanguageToggleButton" class="ui-language-toggle-button" title="UI Ø²Ø¨Ø§Ù† ØªØ¨Ø¯ÛŒÙ„ Ú©Ø±ÛŒÚº" type="button">Ø§Ø±Ø¯Ùˆ</button>
            </div>
            <h1><span class="qai-name-header">QAi</span></h1>
            <button id="moreOptionsButton" class="more-options-button" title="Ù…Ø²ÛŒØ¯ Ø¢Ù¾Ø´Ù†Ø²" type="button"><i class="fas fa-bars"></i></button>
        </div>
        <div class="chat-messages" id="chatMessages">
            <!-- Messages will be dynamically inserted here by Firebase listener -->
        </div>

        <!-- Scroll Arrows -->
        <div id="scrollToTopArrow" class="scroll-arrow" title="Ø§ÙˆÙ¾Ø± Ø¬Ø§Ø¦ÛŒÚº">
            <i class="fas fa-arrow-up"></i>
        </div>
        <div id="scrollToBottomArrow" class="scroll-arrow" title="Ù†ÛŒÚ†Û’ Ø¬Ø§Ø¦ÛŒÚº">
            <i class="fas fa-arrow-down"></i>
        </div>

        <!-- New Chat Input Area -->
        <div class="chat-input-area" id="chatInputArea">
            <div class="action-buttons-top">
                 <button id="qModesButton" class="q-modes-button" title="Ø¬ÙˆØ§Ø¨ÛŒ Ù…ÙˆÚˆ ØªØ¨Ø¯ÛŒÙ„ Ú©Ø±ÛŒÚº" type="button">
                    <i class="fas fa-brain"></i> <span id="qModesButtonText">Q-Modes</span>
                </button>
                <button id="imageAttachButton" class="image-attach-button" title="ØªØµÙˆÛŒØ± Ù…Ù†Ø³Ù„Ú© Ú©Ø±ÛŒÚº" type="button">
                    <i class="fas fa-camera"></i> <span id="imageAttachButtonText">ØªØµÙˆÛŒØ±</span>
                </button>
                <button id="sendButton" type="button">
                    <i class="fas fa-paper-plane"></i> <span id="sendButtonText">Ø¨Ú¾ÛŒØ¬ÛŒÚº</span>
                </button>
            </div>
            <input type="text" id="chatUserInput" placeholder="Ø§Ù¾Ù†Ø§ Ù¾ÛŒØºØ§Ù… ÛŒÛØ§Úº Ù„Ú©Ú¾ÛŒÚº..." autofocus>
            <div id="imagePreviewContainer" class="image-preview-container hidden">
                <img id="imagePreview" src="" alt="ØªØµÙˆÛŒØ± Ú©Ø§ Ù¾ÛŒØ´ Ù†Ø¸Ø§Ø±Û">
                <span id="imageFileName"></span>
                <button id="removeImageButton" class="remove-image-button" title="ØªØµÙˆÛŒØ± ÛÙ¹Ø§Ø¦ÛŒÚº" type="button"><i class="fas fa-times-circle"></i></button>
            </div>
        </div>

        <input type="file" id="imageFileInput" accept="image/*" class="hidden">

    </div>

    <!-- About Modal -->
    <div id="aboutModal" class="modal">
        <div class="modal-content">
            <h2 id="aboutModalTitle">QAi (Query AI) Ú©Û’ Ø¨Ø§Ø±Û’ Ù…ÛŒÚº</h2>
            <p id="aboutModalCreator">
                <strong>*QAi Ø³ÛŒØ¯ Ø³Ø§Ø®Ø± ÛØ§Ø´Ù…ÛŒ Ú©ÛŒ Ú©Ø§ÙˆØ´ Ø§ÙˆØ± Ø®Ø¯Ø§ Ú©ÛŒ ØªÙˆÙÛŒÙ‚ Ø³Û’ Ø¨Ù†Ø§ÛŒØ§ Ú¯ÛŒØ§ Ø¬Ø¯ÛŒØ¯ Ai ÛÛ’*</strong>
            </p>
            <p id="aboutModalP1">
                QAi ØµØ±Ù Ø§ÛŒÚ© Ú†ÛŒÙ¹ Ø¨ÙˆÙ¹ Ù†ÛÛŒÚºØŒ Ø¨Ù„Ú©Û ÛŒÛ Ø§ÛŒÚ© Ø§Ù†Ù‚Ù„Ø§Ø¨ÛŒ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø°ÛØ§Ù†Øª Ú©Ø§ Ù†Ø¸Ø§Ù… ÛÛ’ Ø¬Ùˆ Ø¢Ù¾ Ú©Û’ ÛØ± Ø³ÙˆØ§Ù„ Ú©Ø§ Ø¬ÙˆØ§Ø¨ Ø§Ù†ØªÛØ§Ø¦ÛŒ ØªÙØµÛŒÙ„ØŒ Ø¯Ù„Ú†Ø³Ù¾ÛŒØŒ Ø§ÙˆØ± Ø¯Ø±Ø³ØªÚ¯ÛŒ Ú©Û’ Ø³Ø§ØªÚ¾ ÙØ±Ø§ÛÙ… Ú©Ø±Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ ÚˆÛŒØ²Ø§Ø¦Ù† Ú©ÛŒØ§ Ú¯ÛŒØ§ ÛÛ’Û” Ø§Ø³ Ú©ÛŒ Ø®ØµÙˆØµÛŒØ§Øª Ø§ÙˆØ± Ø§Ù†ÙØ±Ø§Ø¯ÛŒØª Ø§Ø³Û’ Ø¯ÛŒÚ¯Ø± AI Ú†ÛŒÙ¹ Ø¨ÙˆÙ¹Ø³ Ø³Û’ Ù…Ù…ØªØ§Ø² Ú©Ø±ØªÛŒ ÛÛŒÚº:
            </p>
            <ul id="aboutModalList">
                <li data-ur="<strong>Ø¬Ø§Ù…Ø¹ Ø§ÙˆØ± Ú¯ÛØ±Ø§Ø¦ÛŒ Ø³Û’ Ø¬ÙˆØ§Ø¨Ø§Øª:</strong> QAi ÛØ± Ø³ÙˆØ§Ù„ Ú©Û’ ØªÙ…Ø§Ù… Ù…Ù…Ú©Ù†Û Ù¾ÛÙ„ÙˆØ¤Úº Ú©Ø§ Ø§Ø­Ø§Ø·Û Ú©Ø±ØªØ§ ÛÛ’ØŒ Ø§ÙˆØ± Ø¢Ù¾ Ú©Ùˆ Ø§ÛŒØ³Ø§ ØªÙØµÛŒÙ„ÛŒ Ø¬ÙˆØ§Ø¨ ÙØ±Ø§ÛÙ… Ú©Ø±ØªØ§ ÛÛ’ Ø¬Ùˆ Ø¢Ù¾ Ú©ÛŒ ØªÙˆÙ‚Ø¹Ø§Øª Ø³Û’ Ø¨Ú‘Ú¾ Ú©Ø± ÛÙˆØªØ§ ÛÛ’Û” ğŸ“š" data-en="<strong>Comprehensive and In-depth Answers:</strong> QAi covers all possible aspects of every question, providing you with detailed answers that exceed your expectations. ğŸ“š"><strong>Ø¬Ø§Ù…Ø¹ Ø§ÙˆØ± Ú¯ÛØ±Ø§Ø¦ÛŒ Ø³Û’ Ø¬ÙˆØ§Ø¨Ø§Øª:</strong> QAi ÛØ± Ø³ÙˆØ§Ù„ Ú©Û’ ØªÙ…Ø§Ù… Ù…Ù…Ú©Ù†Û Ù¾ÛÙ„ÙˆØ¤Úº Ú©Ø§ Ø§Ø­Ø§Ø·Û Ú©Ø±ØªØ§ ÛÛ’ØŒ Ø§ÙˆØ± Ø¢Ù¾ Ú©Ùˆ Ø§ÛŒØ³Ø§ ØªÙØµÛŒÙ„ÛŒ Ø¬ÙˆØ§Ø¨ ÙØ±Ø§ÛÙ… Ú©Ø±ØªØ§ ÛÛ’ Ø¬Ùˆ Ø¢Ù¾ Ú©ÛŒ ØªÙˆÙ‚Ø¹Ø§Øª Ø³Û’ Ø¨Ú‘Ú¾ Ú©Ø± ÛÙˆØªØ§ ÛÛ’Û” ğŸ“š</li>
                <li data-ur="<strong>ØªØ®Ù„ÛŒÙ‚ÛŒ Ø§ÙˆØ± Ù…Ù†ÙØ±Ø¯ Ø§Ù†Ø¯Ø§Ø²:</strong> ÛŒÛ ØµØ±Ù Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙØ±Ø§ÛÙ… Ù†ÛÛŒÚº Ú©Ø±ØªØ§ØŒ Ø¨Ù„Ú©Û Ø§Ù¾Ù†Û’ Ø¬ÙˆØ§Ø¨Ø§Øª Ú©Ùˆ Ø§ÛŒÚ© Ù…Ù†ÙØ±Ø¯ Ø§ÙˆØ± Ø¯Ù„Ú©Ø´ Ø§Ù†Ø¯Ø§Ø² Ù…ÛŒÚº Ù¾ÛŒØ´ Ú©Ø±ØªØ§ ÛÛ’ØŒ Ø¬Ø³ Ù…ÛŒÚº Ù…Ù†Ø§Ø³Ø¨ ÛÛŒÚˆÙ†Ú¯Ø²ØŒ Ù†Ù…Ø¨Ø±Ù†Ú¯ØŒ Ù¹ÛŒØ¨Ù„Ø²ØŒ Ø§ÙˆØ± Ø§ÛŒÙ…ÙˆØ¬ÛŒØ² Ø´Ø§Ù…Ù„ ÛÙˆØªÛ’ ÛÛŒÚºÛ” âœ¨" data-en="<strong>Creative and Unique Style:</strong> It doesn't just provide information, but presents its answers in a unique and engaging style, including appropriate headings, numbering, tables, and emojis. âœ¨"><strong>ØªØ®Ù„ÛŒÙ‚ÛŒ Ø§ÙˆØ± Ù…Ù†ÙØ±Ø¯ Ø§Ù†Ø¯Ø§Ø²:</strong> ÛŒÛ ØµØ±Ù Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙØ±Ø§ÛÙ… Ù†ÛÛŒÚº Ú©Ø±ØªØ§ØŒ Ø¨Ù„Ú©Û Ø§Ù¾Ù†Û’ Ø¬ÙˆØ§Ø¨Ø§Øª Ú©Ùˆ Ø§ÛŒÚ© Ù…Ù†ÙØ±Ø¯ Ø§ÙˆØ± Ø¯Ù„Ú©Ø´ Ø§Ù†Ø¯Ø§Ø² Ù…ÛŒÚº Ù¾ÛŒØ´ Ú©Ø±ØªØ§ ÛÛ’ØŒ Ø¬Ø³ Ù…ÛŒÚº Ù…Ù†Ø§Ø³Ø¨ ÛÛŒÚˆÙ†Ú¯Ø²ØŒ Ù†Ù…Ø¨Ø±Ù†Ú¯ØŒ Ù¹ÛŒØ¨Ù„Ø²ØŒ Ø§ÙˆØ± Ø§ÛŒÙ…ÙˆØ¬ÛŒØ² Ø´Ø§Ù…Ù„ ÛÙˆØªÛ’ ÛÛŒÚºÛ” âœ¨</li>
                <li data-ur="<strong>ØªØµÙˆÛŒØ± Ø§ÙˆØ± Ù…ØªÙ† Ú©ÛŒ Ø³Ù…Ø¬Ú¾:</strong> QAi Ø§Ø¨ ØªØµØ§ÙˆÛŒØ± Ú©Ùˆ Ø³Ù…Ø¬Ú¾ Ú©Ø± Ø§Ù† Ú©Û’ Ø¨Ø§Ø±Û’ Ù…ÛŒÚº ØªÙØµÛŒÙ„ÛŒ Ø¬ÙˆØ§Ø¨Ø§Øª Ø¯Û’ Ø³Ú©ØªØ§ ÛÛ’ØŒ Ø§ÙˆØ± Ø¢Ù¾ Ú©Û’ Ù…ØªÙ† Ù¾Ø± Ù…Ø¨Ù†ÛŒ Ø³ÙˆØ§Ù„Ø§Øª Ú©Ø§ Ø¨Ú¾ÛŒ Ù…Ú©Ù…Ù„ Ø§Ø­Ø§Ø·Û Ú©Ø±ØªØ§ ÛÛ’Û” ğŸ“¸" data-en="<strong>Image and Text Understanding:</strong> QAi can now understand images and provide detailed answers about them, and also fully covers your text-based questions. ğŸ“¸"><strong>ØªØµÙˆÛŒØ± Ø§ÙˆØ± Ù…ØªÙ† Ú©ÛŒ Ø³Ù…Ø¬Ú¾:</strong> QAi Ø§Ø¨ ØªØµØ§ÙˆÛŒØ± Ú©Ùˆ Ø³Ù…Ø¬Ú¾ Ú©Ø± Ø§Ù† Ú©Û’ Ø¨Ø§Ø±Û’ Ù…ÛŒÚº ØªÙØµÛŒÙ„ÛŒ Ø¬ÙˆØ§Ø¨Ø§Øª Ø¯Û’ Ø³Ú©ØªØ§ ÛÛ’ØŒ Ø§ÙˆØ± Ø¢Ù¾ Ú©Û’ Ù…ØªÙ† Ù¾Ø± Ù…Ø¨Ù†ÛŒ Ø³ÙˆØ§Ù„Ø§Øª Ú©Ø§ Ø¨Ú¾ÛŒ Ù…Ú©Ù…Ù„ Ø§Ø­Ø§Ø·Û Ú©Ø±ØªØ§ ÛÛ’Û” ğŸ“¸</li>
                <li data-ur="<strong>Ù¾ÛŒØ´Ú¯ÛŒ Ø³ÙˆØ§Ù„Ø§Øª Ú©Ø§ Ø§Ø­Ø§Ø·Û:</strong> QAi Ø¢Ù¾ Ú©Û’ Ø°ÛÙ† Ù…ÛŒÚº Ù¾ÛŒØ¯Ø§ ÛÙˆÙ†Û’ ÙˆØ§Ù„Û’ Ù…Ù…Ú©Ù†Û Ø´Ú© Ùˆ Ø´Ø¨ÛØ§Øª ÛŒØ§ Ù…Ø²ÛŒØ¯ Ø³ÙˆØ§Ù„Ø§Øª Ú©Ùˆ Ø¨Ú¾Ø§Ù†Ù¾ Ú©Ø± Ø§Ù†ÛÛŒÚº Ø¨Ú¾ÛŒ Ø§Ù¾Ù†Û’ Ø¬ÙˆØ§Ø¨ Ù…ÛŒÚº Ø´Ø§Ù…Ù„ Ú©Ø±ØªØ§ ÛÛ’ØŒ ØªØ§Ú©Û Ø¢Ù¾ Ú©Ùˆ Ø¨Ø§Ø± Ø¨Ø§Ø± Ù¾ÙˆÚ†Ú¾Ù†Û’ Ú©ÛŒ Ø¶Ø±ÙˆØ±Øª Ù†Û Ù¾Ú‘Û’Û” ğŸ¤”" data-en="<strong>Anticipating Follow-up Questions:</strong> QAi anticipates potential doubts or further questions that may arise in your mind and includes them in its answer, so you don't need to ask repeatedly. ğŸ¤”"><strong>Ù¾ÛŒØ´Ú¯ÛŒ Ø³ÙˆØ§Ù„Ø§Øª Ú©Ø§ Ø§Ø­Ø§Ø·Û:</strong> QAi Ø¢Ù¾ Ú©Û’ Ø°ÛÙ† Ù…ÛŒÚº Ù¾ÛŒØ¯Ø§ ÛÙˆÙ†Û’ ÙˆØ§Ù„Û’ Ù…Ù…Ú©Ù†Û Ø´Ú© Ùˆ Ø´Ø¨ÛØ§Øª ÛŒØ§ Ù…Ø²ÛŒØ¯ Ø³ÙˆØ§Ù„Ø§Øª Ú©Ùˆ Ø¨Ú¾Ø§Ù†Ù¾ Ú©Ø± Ø§Ù†ÛÛŒÚº Ø¨Ú¾ÛŒ Ø§Ù¾Ù†Û’ Ø¬ÙˆØ§Ø¨ Ù…ÛŒÚº Ø´Ø§Ù…Ù„ Ú©Ø±ØªØ§ ÛÛ’ØŒ ØªØ§Ú©Û Ø¢Ù¾ Ú©Ùˆ Ø¨Ø§Ø± Ø¨Ø§Ø± Ù¾ÙˆÚ†Ú¾Ù†Û’ Ú©ÛŒ Ø¶Ø±ÙˆØ±Øª Ù†Û Ù¾Ú‘Û’Û” ğŸ¤”</li>
                <li data-ur="<strong>Ù…Ø®ØªÙ„Ù ÙØ§Ø±Ù…ÛŒÙ¹Ø³ Ù…ÛŒÚº Ø¬ÙˆØ§Ø¨Ø§Øª:</strong> ÛŒÛ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ú©Ùˆ Ù†Û ØµØ±Ù Ø³Ø§Ø¯Û Ù…ØªÙ† Ù…ÛŒÚº Ø¨Ù„Ú©Û Ø®Ù„Ø§ØµÛ’ØŒ ØªÙØµÛŒÙ„ÛŒ ÙˆØ¶Ø§Ø­ØªØŒ Ø§ÙˆØ± ÛŒÛØ§Úº ØªÚ© Ú©Û Ø¬Ø¯ÙˆÙ„ÙˆÚº Ú©ÛŒ ØµÙˆØ±Øª Ù…ÛŒÚº Ø¨Ú¾ÛŒ Ù¾ÛŒØ´ Ú©Ø± Ø³Ú©ØªØ§ ÛÛ’Û” ğŸ“Š" data-en="<strong>Answers in Various Formats:</strong> It can present information not only in plain text but also as summaries, detailed explanations, and even in tabular form. ğŸ“Š"><strong>Ù…Ø®ØªÙ„Ù ÙØ§Ø±Ù…ÛŒÙ¹Ø³ Ù…ÛŒÚº Ø¬ÙˆØ§Ø¨Ø§Øª:</strong> ÛŒÛ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ú©Ùˆ Ù†Û ØµØ±Ù Ø³Ø§Ø¯Û Ù…ØªÙ† Ù…ÛŒÚº Ø¨Ù„Ú©Û Ø®Ù„Ø§ØµÛ’ØŒ ØªÙØµÛŒÙ„ÛŒ ÙˆØ¶Ø§Ø­ØªØŒ Ø§ÙˆØ± ÛŒÛØ§Úº ØªÚ© Ú©Û Ø¬Ø¯ÙˆÙ„ÙˆÚº Ú©ÛŒ ØµÙˆØ±Øª Ù…ÛŒÚº Ø¨Ú¾ÛŒ Ù¾ÛŒØ´ Ú©Ø± Ø³Ú©ØªØ§ ÛÛ’Û” ğŸ“Š</li>
                <li data-ur="<strong>ØªØ®Ù„ÛŒÙ‚ÛŒ ØªØ­Ø±ÛŒØ± Ù…ÛŒÚº Ù…Ø¹Ø§ÙˆÙ†Øª:</strong> Ø¢Ù¾ Ú©Ùˆ Ú©ÛØ§Ù†ÛŒÙˆÚºØŒ Ø´Ø§Ø¹Ø±ÛŒØŒ ÛŒØ§ Ø¯ÛŒÚ¯Ø± ØªØ®Ù„ÛŒÙ‚ÛŒ Ù…ÙˆØ§Ø¯ Ú©Û’ Ù„ÛŒÛ’ Ù†Ø¦Û’ Ø¢Ø¦ÛŒÚˆÛŒØ§Ø² Ø§ÙˆØ± Ø§Ø¨ØªØ¯Ø§Ø¦ÛŒ Ù†Ú©Ø§Øª ÙØ±Ø§ÛÙ… Ú©Ø± Ø³Ú©ØªØ§ ÛÛ’Û” ğŸ’¡" data-en="<strong>Assistance in Creative Writing:</strong> It can provide you with new ideas and starting points for stories, poetry, or other creative content. ğŸ’¡"><strong>ØªØ®Ù„ÛŒÙ‚ÛŒ ØªØ­Ø±ÛŒØ± Ù…ÛŒÚº Ù…Ø¹Ø§ÙˆÙ†Øª:</strong> Ø¢Ù¾ Ú©Ùˆ Ú©ÛØ§Ù†ÛŒÙˆÚºØŒ Ø´Ø§Ø¹Ø±ÛŒØŒ ÛŒØ§ Ø¯ÛŒÚ¯Ø± ØªØ®Ù„ÛŒÙ‚ÛŒ Ù…ÙˆØ§Ø¯ Ú©Û’ Ù„ÛŒÛ’ Ù†Ø¦Û’ Ø¢Ø¦ÛŒÚˆÛŒØ§Ø² Ø§ÙˆØ± Ø§Ø¨ØªØ¯Ø§Ø¦ÛŒ Ù†Ú©Ø§Øª ÙØ±Ø§ÛÙ… Ú©Ø± Ø³Ú©ØªØ§ ÛÛ’Û” ğŸ’¡</li>
                <li data-ur="<strong>Ø¬ÙˆØ§Ø¨ Ú©Ø§ Ø§Ù†Ø¯Ø§Ø² (Tone):</strong> Ø¢Ù¾ Ø§Ù¾Ù†ÛŒ Ù…Ø±Ø¶ÛŒ Ú©Û’ Ù…Ø·Ø§Ø¨Ù‚ Ø¬ÙˆØ§Ø¨ Ú©Ø§ Ø§Ù†Ø¯Ø§Ø² Ù…Ù†ØªØ®Ø¨ Ú©Ø± Ø³Ú©ØªÛ’ ÛÛŒÚºØŒ Ø¬ÛŒØ³Û’ Ø¢Ù¹ÙˆØŒ Ø§Ø³Ù„Ø§Ù…ÛŒØŒ ÙÙ„Ø³ÙÛŒØ§Ù†ÛØŒ Ø³Ø§Ø¦Ù†Ø³ÛŒØŒ Ø§Ø¯Ø¨ÛŒØŒ Ù…Ø²Ø§Ø­ÛŒÛØŒ Ø¨Ú†Ú¯Ø§Ù†Û ÛŒØ§ Ù…Ú©Ø³ Ù…ÙˆÚˆÛ” ğŸ—£ï¸" data-en="<strong>Response Tone:</strong> You can choose the tone of the response according to your preference, such as Auto, Islamic, Philosophical, Scientific, Literary, Humorous, Childish or Mix Mode. ğŸ—£ï¸"><strong>Ø¬ÙˆØ§Ø¨ Ú©Ø§ Ø§Ù†Ø¯Ø§Ø² (Tone):</strong> Ø¢Ù¾ Ø§Ù¾Ù†ÛŒ Ù…Ø±Ø¶ÛŒ Ú©Û’ Ù…Ø·Ø§Ø¨Ù‚ Ø¬ÙˆØ§Ø¨ Ú©Ø§ Ø§Ù†Ø¯Ø§Ø² Ù…Ù†ØªØ®Ø¨ Ú©Ø± Ø³Ú©ØªÛ’ ÛÛŒÚºØŒ Ø¬ÛŒØ³Û’ Ø¢Ù¹ÙˆØŒ Ø§Ø³Ù„Ø§Ù…ÛŒØŒ ÙÙ„Ø³ÙÛŒØ§Ù†ÛØŒ Ø³Ø§Ø¦Ù†Ø³ÛŒØŒ Ø§Ø¯Ø¨ÛŒØŒ Ù…Ø²Ø§Ø­ÛŒÛØŒ Ø¨Ú†Ú¯Ø§Ù†Û ÛŒØ§ Ù…Ú©Ø³ Ù…ÙˆÚˆÛ” ğŸ—£ï¸</li>
                <li data-ur="<strong>Ù…Ø³ØªÙ‚Ø¨Ù„ Ú©ÛŒ Ø®ØµÙˆØµÛŒØ§Øª:</strong> QAi Ú©Ùˆ Ù…Ø³ØªÙ‚Ø¨Ù„ Ú©ÛŒ AI Ù¹ÛŒÚ©Ù†Ø§Ù„ÙˆØ¬ÛŒØ² Ø§ÙˆØ± ÙÛŒÚ†Ø±Ø² Ú©Ùˆ Ø¢Ø³Ø§Ù†ÛŒ Ø³Û’ Ø´Ø§Ù…Ù„ Ú©Ø±Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ ÚˆÛŒØ²Ø§Ø¦Ù† Ú©ÛŒØ§ Ú¯ÛŒØ§ ÛÛ’Û” ğŸš€" data-en="<strong>Future Features:</strong> QAi is designed to easily incorporate future AI technologies and features. ğŸš€"><strong>Ù…Ø³ØªÙ‚Ø¨Ù„ Ú©ÛŒ Ø®ØµÙˆØµÛŒØ§Øª:</strong> QAi Ú©Ùˆ Ù…Ø³ØªÙ‚Ø¨Ù„ Ú©ÛŒ AI Ù¹ÛŒÚ©Ù†Ø§Ù„ÙˆØ¬ÛŒØ² Ø§ÙˆØ± ÙÛŒÚ†Ø±Ø² Ú©Ùˆ Ø¢Ø³Ø§Ù†ÛŒ Ø³Û’ Ø´Ø§Ù…Ù„ Ú©Ø±Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ ÚˆÛŒØ²Ø§Ø¦Ù† Ú©ÛŒØ§ Ú¯ÛŒØ§ ÛÛ’Û” ğŸš€</li>
            </ul>
            <p id="aboutModalP2">
                ÛÙ…Ø§Ø±Ø§ Ù…Ù‚ØµØ¯ Ø¢Ù¾ Ú©Ùˆ Ø§ÛŒÚ© Ø§ÛŒØ³Ø§ AI ØªØ¬Ø±Ø¨Û ÙØ±Ø§ÛÙ… Ú©Ø±Ù†Ø§ ÛÛ’ Ø¬Ùˆ Ù†Û ØµØ±Ù Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙØ±Ø§ÛÙ… Ú©Ø±Û’ Ø¨Ù„Ú©Û Ø¢Ù¾ Ú©Ùˆ Ø­ÛŒØ±Ø§Ù† Ú©Ø± Ø¯Û’ Ø§ÙˆØ± Ø¢Ù¾ Ú©ÛŒ Ø³ÙˆÚ† Ú©Ùˆ ÙˆØ³Ø¹Øª Ø¯Û’Û” QAi Ø¢Ù¾ Ú©Û’ Ø³Ø§ØªÚ¾ ÛØ± Ù‚Ø¯Ù… Ù¾Ø± Ø§ÛŒÚ© Ø°ÛÛŒÙ† Ø§ÙˆØ± Ù‚Ø§Ø¨Ù„ Ø§Ø¹ØªÙ…Ø§Ø¯ Ù…Ø¹Ø§ÙˆÙ† Ú©Û’ Ø·ÙˆØ± Ù¾Ø± Ù…ÙˆØ¬ÙˆØ¯ ÛÛ’Û” ğŸŒŸ
            </p>
            <button id="aboutModalCloseButton" class="modal-close-button" type="button">Ø¨Ù†Ø¯ Ú©Ø±ÛŒÚº</button>
        </div>
    </div>

    <!-- Message Modal (for alerts/confirmations) -->
    <div id="messageModal" class="modal">
        <div class="modal-content">
            <h2 id="messageModalTitle"></h2>
            <p id="messageModalContent"></p>
            <button id="messageModalCloseButton" class="modal-close-button" type="button">Ù¹Ú¾ÛŒÚ© ÛÛ’</button>
        </div>
    </div>

    <!-- Response Tone Modal -->
    <div id="toneModal" class="modal">
        <div class="modal-content">
            <h2 id="toneModalTitle">Ø¬ÙˆØ§Ø¨ Ú©Ø§ Ø§Ù†Ø¯Ø§Ø² Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº</h2>
            <div class="flex flex-wrap justify-center gap-4 mt-4">
                <button class="tone-option-button" data-tone="auto" data-ur="Ø¢Ù¹Ùˆ" data-en="Auto" type="button">Ø¢Ù¹Ùˆ</button>
                <button class="tone-option-button" data-tone="islamic" data-ur="Ø§Ø³Ù„Ø§Ù…ÛŒ" data-en="Islamic" type="button">Ø§Ø³Ù„Ø§Ù…ÛŒ</button>
                <button class="tone-option-button" data-tone="philosophical" data-ur="ÙÙ„Ø³ÙÛŒØ§Ù†Û" data-en="Philosophical" type="button">ÙÙ„Ø³ÙÛŒØ§Ù†Û</button>
                <button class="tone-option-button" data-tone="scientific" data-ur="Ø³Ø§Ø¦Ù†Ø³ÛŒ" data-en="Scientific" type="button">Ø³Ø§Ø¦Ù†Ø³ÛŒ</button>
                <button class="tone-option-button" data-tone="adbi" data-ur="Ø§Ø¯Ø¨ÛŒ" data-en="Literary" type="button">Ø§Ø¯Ø¨ÛŒ</button>
                <button class="tone-option-button" data-tone="humorous" data-ur="Ù…Ø²Ø§Ø­ÛŒÛ" data-en="Humorous" type="button">Ù…Ø²Ø§Ø­ÛŒÛ</button>
                <button class="tone-option-button" data-tone="childish" data-ur="Ø¨Ú†Ú¯Ø§Ù†Û" data-en="Childish" type="button">Ø¨Ú†Ú¯Ø§Ù†Û</button>
                <button class="tone-option-button" data-tone="mix" data-ur="Ù…Ú©Ø³ Ù…ÙˆÚˆ" data-en="Mix Mode" type="button">Ù…Ú©Ø³ Ù…ÙˆÚˆ</button>
            </div>
            <button id="toneModalCloseButton" class="modal-close-button mt-4" type="button">Ø¨Ù†Ø¯ Ú©Ø±ÛŒÚº</button>
        </div>
    </div>

    <!-- Q-Modes Modal -->
    <div id="qModesSelectionModal" class="modal">
        <div class="modal-content">
            <h2 id="qModesModalTitle">Ø¬ÙˆØ§Ø¨ÛŒ Ù…ÙˆÚˆ Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº</h2>
            <div class="flex flex-wrap justify-center gap-4 mt-4">
                <button class="q-modes-option-button" data-qmode="quantum" data-ur="Ú©ÙˆØ§Ù†Ù¹Ù… Ù…ÙˆÚˆ (ØªÙØµÛŒÙ„ÛŒ)" data-en="Quantum Mode (Detailed)" type="button">Ú©ÙˆØ§Ù†Ù¹Ù… Ù…ÙˆÚˆ (ØªÙØµÛŒÙ„ÛŒ)</button>
                <button class="q-modes-option-button" data-qmode="quick" data-ur="Ú©ÙˆØ¦ÛŒÚ© Ù…ÙˆÚˆ (Ù…Ø®ØªØµØ±)" data-en="Quick Mode (Concise)" type="button">Ú©ÙˆØ¦ÛŒÚ© Ù…ÙˆÚˆ (Ù…Ø®ØªØµØ±)</button>
            </div>
            <button id="qModesModalCloseButton" class="modal-close-button mt-4" type="button">Ø¨Ù†Ø¯ Ú©Ø±ÛŒÚº</button>
        </div>
    </div>


    <!-- More Options Sidebar -->
    <div id="moreOptionsSidebar" class="sidebar">
        <div class="sidebar-header">
            <span id="sidebarTitle"><i class="fas fa-cogs"></i> Ø¢Ù¾Ø´Ù†Ø²</span>
            <button id="sidebarCloseButton" class="sidebar-close-button" type="button"><i class="fas fa-times"></i></button>
        </div>
        <div class="sidebar-options">
            <div class="sidebar-option" id="aboutOption">
                <i class="fas fa-info-circle"></i> <span class="sidebar-text">QAi Ú©Û’ Ø¨Ø§Ø±Û’ Ù…ÛŒÚº</span>
            </div>
            <div class="sidebar-option" id="responseLangOptionContainer">
                <i class="fas fa-language"></i> <span class="sidebar-text">Ø¬ÙˆØ§Ø¨ÛŒ Ø²Ø¨Ø§Ù† Ú©ÛŒ ØªØ±Ø¬ÛŒØ­:</span>
                <div class="language-options-container">
                    <button class="language-option selected" data-lang="ur" type="button">Ø§Ø±Ø¯Ùˆ</button>
                    <button class="language-option" data-lang="en" type="button">English</button>
                    <button class="language-option" data-lang="ur-roman" type="button">Ø±ÙˆÙ…Ù† Ø§Ø±Ø¯Ùˆ</button>
                </div>
            </div>
            <div class="sidebar-option" id="themeToggleOption">
                <i class="fas fa-moon"></i> <span class="sidebar-text">ØªÚ¾ÛŒÙ… ØªØ¨Ø¯ÛŒÙ„ Ú©Ø±ÛŒÚº</span>
            </div>
            <div class="sidebar-option" id="newChatOption">
                <i class="fas fa-plus-circle"></i> <span class="sidebar-text">Ù†Ø¦ÛŒ Ú¯ÙØªÚ¯Ùˆ Ø´Ø±ÙˆØ¹ Ú©Ø±ÛŒÚº</span>
            </div>
            <div class="sidebar-option" id="responseToneOption">
                <i class="fas fa-microphone-alt"></i> <span class="sidebar-text">Ø¬ÙˆØ§Ø¨ Ú©Ø§ Ø§Ù†Ø¯Ø§Ø²</span>
            </div>
            <div class="sidebar-option" id="creativeWritingOption">
                <i class="fas fa-lightbulb"></i> <span class="sidebar-text">ØªØ®Ù„ÛŒÙ‚ÛŒ ØªØ­Ø±ÛŒØ±</span>
            </div>
            <div class="sidebar-option" id="copyChatOption">
                <i class="fas fa-copy"></i> <span class="sidebar-text">Ù¾ÙˆØ±ÛŒ Ú†ÛŒÙ¹ Ú©Ø§Ù¾ÛŒ Ú©Ø±ÛŒÚº</span>
            </div>
            <div class="sidebar-option" id="exportChatOption">
                <i class="fas fa-download"></i> <span class="sidebar-text">Ú†ÛŒÙ¹ Ø§ÛŒÚ©Ø³Ù¾ÙˆØ±Ù¹ Ú©Ø±ÛŒÚº (Ù¹ÛŒÚ©Ø³Ù¹)</span>
            </div>
        </div>
    </div>

    <!-- Bottom Status Bar -->
    <div class="bottom-status-bar">
        <span class="status-text" id="bottomStatusBarText">QAi - Ø¢Ù¾ Ú©Ø§ Ø°ÛÛŒÙ† Ø§ÙˆØ± ØªØ®Ù„ÛŒÙ‚ÛŒ Ù…Ø¹Ø§ÙˆÙ†</span>
    </div>

    <script type="module">
        // Firebase Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, setDoc, updateDoc, arrayUnion, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // DOM Elements
        const chatMessages = document.getElementById('chatMessages');
        const chatUserInput = document.getElementById('chatUserInput');
        const sendButton = document.getElementById('sendButton');
        const imageAttachButton = document.getElementById('imageAttachButton');
        const qModesButton = document.getElementById('qModesButton');
        const moreOptionsButton = document.getElementById('moreOptionsButton');
        const moreOptionsSidebar = document.getElementById('moreOptionsSidebar');
        const aboutModal = document.getElementById('aboutModal');
        const messageModal = document.getElementById('messageModal');
        const toneModal = document.getElementById('toneModal');
        const qModesSelectionModal = document.getElementById('qModesSelectionModal');
        const imageFileInput = document.getElementById('imageFileInput');
        const imagePreviewContainer = document.getElementById('imagePreviewContainer');
        const imagePreview = document.getElementById('imagePreview');
        const imageFileName = document.getElementById('imageFileName');
        const removeImageButton = document.getElementById('removeImageButton');
        const scrollToTopArrow = document.getElementById('scrollToTopArrow');
        const scrollToBottomArrow = document.getElementById('scrollToBottomArrow');
        
        // App State
        let currentUILanguage = 'ur';
        let currentImageUploadData = { base64: null, mimeType: null };
        let lastUserPrompt = '';
        let localChatHistory = []; 
        let unsubscribeChat; 
        let isFirstLoad = true;
        let audioCtx; 
        let isAudioInitialized = false;
        let isLoading = false; // <<< KEY STATE VARIABLE FOR LOADING

        // Firebase State
        let db, auth, userId, app;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'qai-chatbot-default';

        // UI Text Translations
        const uiTexts = {
            ur: {
                themeToggleTitle: "ØªÚ¾ÛŒÙ… ØªØ¨Ø¯ÛŒÙ„ Ú©Ø±ÛŒÚº",
                qModesShortcutTitle: "Ø¬ÙˆØ§Ø¨ÛŒ Ù…ÙˆÚˆ",
                toneShortcutTitle: "Ø¬ÙˆØ§Ø¨ Ú©Ø§ Ø§Ù†Ø¯Ø§Ø²",
                uiLangToggleText: "Ø§Ø±Ø¯Ùˆ",
                moreOptionsTitle: "Ù…Ø²ÛŒØ¯ Ø¢Ù¾Ø´Ù†Ø²",
                suggestedQuestionsTitle: "Ú©ÛŒØ§ Ø¢Ù¾ Ú©ÛŒ Ù…Ø¯Ø¯ Ú©Ø± Ø³Ú©ØªØ§ ÛÙˆÚºØŸ ğŸ¤”",
                welcomeMessage: "Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÛŒÚ©Ù…! Ù…ÛŒÚº QAi ÛÙˆÚºØŒ Ø¢Ù¾ Ú©Ø§ Ø°ÛÛŒÙ† Ø§ÙˆØ± ØªØ®Ù„ÛŒÙ‚ÛŒ Ù…Ø¹Ø§ÙˆÙ†Û” Ù…ÛŒÚº Ø¢Ù¾ Ú©Û’ ÛØ± Ø³ÙˆØ§Ù„ Ú©Ø§ Ø¬ÙˆØ§Ø¨ Ø¯ÛŒÙ†Û’ Ø§ÙˆØ± Ø¢Ù¾ Ú©ÛŒ Ù…Ø¯Ø¯ Ú©Ø±Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ Ø­Ø§Ø¶Ø± ÛÙˆÚºÛ” âœ¨",
                copyAction: "Ú©Ø§Ù¾ÛŒ Ú©Ø±ÛŒÚº",
                speakAction: "Ø³Ù†ÛŒÚº",
                detailAction: "ØªÙØµÛŒÙ„",
                summaryAction: "Ø®Ù„Ø§ØµÛ",
                regenerateAction: "Ø¯ÙˆØ¨Ø§Ø±Û Ø¨Ù†Ø§Ø¦ÛŒÚº",
                copyQuestionAction: "Ø³ÙˆØ§Ù„ Ú©Ø§Ù¾ÛŒ Ú©Ø±ÛŒÚº",
                qModesButtonText: "Q-Modes",
                imageAttachButtonText: "ØªØµÙˆÛŒØ±",
                sendButtonText: "Ø¨Ú¾ÛŒØ¬ÛŒÚº",
                inputPlaceholder: "Ø§Ù¾Ù†Ø§ Ù¾ÛŒØºØ§Ù… ÛŒÛØ§Úº Ù„Ú©Ú¾ÛŒÚº...",
                imagePreviewAlt: "ØªØµÙˆÛŒØ± Ú©Ø§ Ù¾ÛŒØ´ Ù†Ø¸Ø§Ø±Û",
                removeImageTitle: "ØªØµÙˆÛŒØ± ÛÙ¹Ø§Ø¦ÛŒÚº",
                aboutModalTitle: "QAi (Query AI) Ú©Û’ Ø¨Ø§Ø±Û’ Ù…ÛŒÚº",
                aboutModalCreator: "<strong>*QAi Ø³ÛŒØ¯ Ø³Ø§Ø®Ø± ÛØ§Ø´Ù…ÛŒ Ú©ÛŒ Ú©Ø§ÙˆØ´ Ø§ÙˆØ± Ø®Ø¯Ø§ Ú©ÛŒ ØªÙˆÙÛŒÙ‚ Ø³Û’ Ø¨Ù†Ø§ÛŒØ§ Ú¯ÛŒØ§ Ø¬Ø¯ÛŒØ¯ Ai ÛÛ’*</strong>",
                aboutModalP1: "QAi ØµØ±Ù Ø§ÛŒÚ© Ú†ÛŒÙ¹ Ø¨ÙˆÙ¹ Ù†ÛÛŒÚºØŒ Ø¨Ù„Ú©Û ÛŒÛ Ø§ÛŒÚ© Ø§Ù†Ù‚Ù„Ø§Ø¨ÛŒ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø°ÛØ§Ù†Øª Ú©Ø§ Ù†Ø¸Ø§Ù… ÛÛ’ Ø¬Ùˆ Ø¢Ù¾ Ú©Û’ ÛØ± Ø³ÙˆØ§Ù„ Ú©Ø§ Ø¬ÙˆØ§Ø¨ Ø§Ù†ØªÛØ§Ø¦ÛŒ ØªÙØµÛŒÙ„ØŒ Ø¯Ù„Ú†Ø³Ù¾ÛŒØŒ Ø§ÙˆØ± Ø¯Ø±Ø³ØªÚ¯ÛŒ Ú©Û’ Ø³Ø§ØªÚ¾ ÙØ±Ø§ÛÙ… Ú©Ø±Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ ÚˆÛŒØ²Ø§Ø¦Ù† Ú©ÛŒØ§ Ú¯ÛŒØ§ ÛÛ’Û” Ø§Ø³ Ú©ÛŒ Ø®ØµÙˆØµÛŒØ§Øª Ø§ÙˆØ± Ø§Ù†ÙØ±Ø§Ø¯ÛŒØª Ø§Ø³Û’ Ø¯ÛŒÚ¯Ø± AI Ú†ÛŒÙ¹ Ø¨ÙˆÙ¹Ø³ Ø³Û’ Ù…Ù…ØªØ§Ø² Ú©Ø±ØªÛŒ ÛÛŒÚº:",
                aboutModalP2: "ÛÙ…Ø§Ø±Ø§ Ù…Ù‚ØµØ¯ Ø¢Ù¾ Ú©Ùˆ Ø§ÛŒÚ© Ø§ÛŒØ³Ø§ AI ØªØ¬Ø±Ø¨Û ÙØ±Ø§ÛÙ… Ú©Ø±Ù†Ø§ ÛÛ’ Ø¬Ùˆ Ù†Û ØµØ±Ù Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙØ±Ø§ÛÙ… Ú©Ø±Û’ Ø¨Ù„Ú©Û Ø¢Ù¾ Ú©Ùˆ Ø­ÛŒØ±Ø§Ù† Ú©Ø± Ø¯Û’ Ø§ÙˆØ± Ø¢Ù¾ Ú©ÛŒ Ø³ÙˆÚ† Ú©Ùˆ ÙˆØ³Ø¹Øª Ø¯Û’Û” QAi Ø¢Ù¾ Ú©Û’ Ø³Ø§ØªÚ¾ ÛØ± Ù‚Ø¯Ù… Ù¾Ø± Ø§ÛŒÚ© Ø°ÛÛŒÙ† Ø§ÙˆØ± Ù‚Ø§Ø¨Ù„ Ø§Ø¹ØªÙ…Ø§Ø¯ Ù…Ø¹Ø§ÙˆÙ† Ú©Û’ Ø·ÙˆØ± Ù¾Ø± Ù…ÙˆØ¬ÙˆØ¯ ÛÛ’Û” ğŸŒŸ",
                modalCloseButton: "Ø¨Ù†Ø¯ Ú©Ø±ÛŒÚº",
                messageModalDefaultButton: "Ù¹Ú¾ÛŒÚ© ÛÛ’",
                toneModalTitle: "Ø¬ÙˆØ§Ø¨ Ú©Ø§ Ø§Ù†Ø¯Ø§Ø² Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº",
                toneAuto: "Ø¢Ù¹Ùˆ",
                toneIslamic: "Ø§Ø³Ù„Ø§Ù…ÛŒ",
                tonePhilosophical: "ÙÙ„Ø³ÙÛŒØ§Ù†Û",
                toneScientific: "Ø³Ø§Ø¦Ù†Ø³ÛŒ",
                toneAdbi: "Ø§Ø¯Ø¨ÛŒ",
                toneHumorous: "Ù…Ø²Ø§Ø­ÛŒÛ",
                toneChildish: "Ø¨Ú†Ú¯Ø§Ù†Û",
                toneMix: "Ù…Ú©Ø³ Ù…ÙˆÚˆ",
                qModesModalTitle: "Ø¬ÙˆØ§Ø¨ÛŒ Ù…ÙˆÚˆ Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº",
                qModeQuantumText: "Ú©ÙˆØ§Ù†Ù¹Ù… Ù…ÙˆÚˆ (ØªÙØµÛŒÙ„ÛŒ)",
                qModeQuickText: "Ú©ÙˆØ¦ÛŒÚ© Ù…ÙˆÚˆ (Ù…Ø®ØªØµØ±)",
                sidebarTitle: "Ø¢Ù¾Ø´Ù†Ø²",
                sidebarAbout: "QAi Ú©Û’ Ø¨Ø§Ø±Û’ Ù…ÛŒÚº",
                sidebarResponseLang: "Ø¬ÙˆØ§Ø¨ÛŒ Ø²Ø¨Ø§Ù† Ú©ÛŒ ØªØ±Ø¬ÛŒØ­:",
                sidebarThemeToggle: "ØªÚ¾ÛŒÙ… ØªØ¨Ø¯ÛŒÙ„ Ú©Ø±ÛŒÚº",
                sidebarNewChat: "Ù†Ø¦ÛŒ Ú¯ÙØªÚ¯Ùˆ Ø´Ø±ÙˆØ¹ Ú©Ø±ÛŒÚº",
                sidebarResponseTone: "Ø¬ÙˆØ§Ø¨ Ú©Ø§ Ø§Ù†Ø¯Ø§Ø²",
                sidebarCreativeWriting: "ØªØ®Ù„ÛŒÙ‚ÛŒ ØªØ­Ø±ÛŒØ±",
                sidebarCopyChat: "Ù¾ÙˆØ±ÛŒ Ú†ÛŒÙ¹ Ú©Ø§Ù¾ÛŒ Ú©Ø±ÛŒÚº",
                sidebarExportChat: "Ú†ÛŒÙ¹ Ø§ÛŒÚ©Ø³Ù¾ÙˆØ±Ù¹ Ú©Ø±ÛŒÚº (Ù¹ÛŒÚ©Ø³Ù¹)",
                bottomStatusBarText: "QAi - Ø¢Ù¾ Ú©Ø§ Ø°ÛÛŒÙ† Ø§ÙˆØ± ØªØ®Ù„ÛŒÙ‚ÛŒ Ù…Ø¹Ø§ÙˆÙ†",
                copiedSuccessTitle: "Ú©Ø§Ù¾ÛŒ ÛÙˆ Ú¯ÛŒØ§",
                copiedSuccessMessage: "Ù…ØªÙ† Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ú©Ù„Ù¾ Ø¨ÙˆØ±Úˆ Ù¾Ø± Ú©Ø§Ù¾ÛŒ ÛÙˆ Ú¯ÛŒØ§ ÛÛ’Û”",
                copiedErrorTitle: "Ú©Ø§Ù¾ÛŒ Ù†ÛÛŒÚº ÛÙˆØ§",
                copiedErrorMessage: "Ù…ØªÙ† Ú©Ø§Ù¾ÛŒ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ù†Ø§Ú©Ø§Ù…ÛŒÛ”",
                ttsNotSupportedTitle: "Ø³Ù¾ÙˆØ±Ù¹ Ù†ÛÛŒÚº ÛÛ’",
                ttsNotSupportedMessage: "Ø¢Ù¾ Ú©Ø§ Ø¨Ø±Ø§Ø¤Ø²Ø± Ù¹ÛŒÚ©Ø³Ù¹ Ù¹Ùˆ Ø§Ø³Ù¾ÛŒÚ† Ú©Ùˆ Ø³Ù¾ÙˆØ±Ù¹ Ù†ÛÛŒÚº Ú©Ø±ØªØ§Û”",
                emptyMessageTitle: "Ø®Ø§Ù„ÛŒ Ù¾ÛŒØºØ§Ù…",
                emptyMessageContent: "Ø¨Ø±Ø§Ø¦Û’ Ù…ÛØ±Ø¨Ø§Ù†ÛŒ Ú©Ú†Ú¾ Ù„Ú©Ú¾ÛŒÚº ÛŒØ§ ØªØµÙˆÛŒØ± Ù…Ù†Ø³Ù„Ú© Ú©Ø±ÛŒÚºÛ” âœï¸",
                summaryRequestTitle: "Ø®Ù„Ø§ØµÛ",
                summaryRequestMessage: "QAi Ø®Ù„Ø§ØµÛ ØªÛŒØ§Ø± Ú©Ø± Ø±ÛØ§ ÛÛ’... ğŸ“",
                detailedRequestTitle: "ØªÙØµÛŒÙ„ÛŒ Ø¬ÙˆØ§Ø¨",
                detailedRequestMessage: "QAi Ù…Ø²ÛŒØ¯ ØªÙØµÛŒÙ„ÛŒ Ø¬ÙˆØ§Ø¨ ØªÛŒØ§Ø± Ú©Ø± Ø±ÛØ§ ÛÛ’... ğŸ“š",
                regenerateFailTitle: "Ø¯ÙˆØ¨Ø§Ø±Û Ù†ÛÛŒÚº Ø¨Ù†Ø§ÛŒØ§ Ø¬Ø§ Ø³Ú©ØªØ§",
                regenerateFailMessage: "Ø¯ÙˆØ¨Ø§Ø±Û Ø¨Ù†Ø§Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ Ú©ÙˆØ¦ÛŒ Ù¾Ú†Ú¾Ù„Ø§ Ø³ÙˆØ§Ù„ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº ÛÛ’Û” ğŸ”„",
                regenerateRequestTitle: "Ø¯ÙˆØ¨Ø§Ø±Û Ø¨Ù†Ø§Ø¦ÛŒÚº",
                regenerateRequestMessage: "QAi Ø¬ÙˆØ§Ø¨ Ø¯ÙˆØ¨Ø§Ø±Û Ø¨Ù†Ø§ Ø±ÛØ§ ÛÛ’... ğŸ”„",
                creativeIdeaTitle: "ØªØ®Ù„ÛŒÙ‚ÛŒ Ø¢Ø¦ÛŒÚˆÛŒØ§",
                creativeIdeaMessage: "QAi Ø¢Ù¾ Ú©Û’ Ù„ÛŒÛ’ Ø§ÛŒÚ© ØªØ®Ù„ÛŒÙ‚ÛŒ ØªØ­Ø±ÛŒØ± Ú©Ø§ Ø¢Ø¦ÛŒÚˆÛŒØ§ ØªÛŒØ§Ø± Ú©Ø± Ø±ÛØ§ ÛÛ’... ğŸ’¡",
                toneSelectedTitle: "Ø§Ù†Ø¯Ø§Ø² Ù…Ù†ØªØ®Ø¨",
                toneSelectedMessage: (tone) => `Ø¬ÙˆØ§Ø¨ Ú©Ø§ Ø§Ù†Ø¯Ø§Ø²: "${tone}" Ù…Ù†ØªØ®Ø¨ Ú©ÛŒØ§ Ú¯ÛŒØ§ ÛÛ’Û” âœ…`,
                qModeSelectedTitle: "Ù…ÙˆÚˆ Ù…Ù†ØªØ®Ø¨",
                qModeSelectedMessage: (mode) => `Ø¬ÙˆØ§Ø¨ÛŒ Ù…ÙˆÚˆ: "${mode}" Ù…Ù†ØªØ®Ø¨ Ú©ÛŒØ§ Ú¯ÛŒØ§ ÛÛ’Û” âœ…`,
                newChatStartedTitle: "Ù†Ø¦ÛŒ Ú¯ÙØªÚ¯Ùˆ",
                newChatStartedMessage: "Ø§ÛŒÚ© Ù†Ø¦ÛŒ Ú¯ÙØªÚ¯Ùˆ Ø´Ø±ÙˆØ¹ Ú©ÛŒ Ú¯Ø¦ÛŒ ÛÛ’Û” ğŸš€",
                invalidFileTitle: "ØºÙ„Ø· ÙØ§Ø¦Ù„",
                invalidFileMessage: "Ø¨Ø±Ø§Û Ú©Ø±Ù… Ø§ÛŒÚ© ØªØµÙˆÛŒØ± ÙØ§Ø¦Ù„ Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚºÛ” ğŸ–¼ï¸",
                fileReadErrorTitle: "ÙØ§Ø¦Ù„ Ù¾Ú‘Ú¾Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ",
                fileReadErrorMessage: "ØªØµÙˆÛŒØ± Ú©Ùˆ Ù¾Ú‘Ú¾Ù†Û’ Ù…ÛŒÚº Ù…Ø³Ø¦Ù„Û Ù¾ÛŒØ´ Ø¢ÛŒØ§Û” ğŸ˜",
                chatExportedTitle: "Ø§ÛŒÚ©Ø³Ù¾ÙˆØ±Ù¹ ÛÙˆ Ú¯ÛŒØ§",
                chatExportedMessage: "Ú†ÛŒÙ¹ ÛØ³Ù¹Ø±ÛŒ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø§ÛŒÚ©Ø³Ù¾ÙˆØ±Ù¹ ÛÙˆ Ú¯Ø¦ÛŒ ÛÛ’Û” ğŸ’¾",
                aiResponseLangChangedTitle: "Ø¬ÙˆØ§Ø¨ÛŒ Ø²Ø¨Ø§Ù† ØªØ¨Ø¯ÛŒÙ„",
                aiResponseLangChangedMessage: (lang) => `QAi Ø§Ø¨ ${lang} Ù…ÛŒÚº Ø¬ÙˆØ§Ø¨ Ø¯Û’ Ú¯Ø§Û” ğŸ—£ï¸`,
                uiLangPreferenceTitle: "UI Ø²Ø¨Ø§Ù† Ú©ÛŒ ØªØ±Ø¬ÛŒØ­",
                uiLangPreferenceMessage: "Ø¨Ø±Ø§Û Ú©Ø±Ù… Ø³Ø§Ø¦ÛŒÚˆØ¨Ø§Ø± Ø³Û’ Ø§Ù¾Ù†ÛŒ Ø¬ÙˆØ§Ø¨ÛŒ Ø²Ø¨Ø§Ù† Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚºÛ” ÛŒÛ Ø¨Ù¹Ù† ØµØ±Ù UI Ú©ÛŒ Ø²Ø¨Ø§Ù† ØªØ¨Ø¯ÛŒÙ„ Ú©Ø±ØªØ§ ÛÛ’Û” ğŸŒ",
                scrollToTopTitle: "Ø§ÙˆÙ¾Ø± Ø¬Ø§Ø¦ÛŒÚº",
                scrollToBottomTitle: "Ù†ÛŒÚ†Û’ Ø¬Ø§Ø¦ÛŒÚº",
                qaiTyping: "QAi Ù¹Ø§Ø¦Ù¾ Ú©Ø± Ø±ÛØ§ ÛÛ’",
                errorGeneralTitle: "Ø®Ø±Ø§Ø¨ÛŒ",
                errorGeneralMessage: "Ù…Ø¹Ø°Ø±ØªØŒ Ø§ÛŒÚ© Ø®Ø±Ø§Ø¨ÛŒ Ù¾ÛŒØ´ Ø¢Ú¯Ø¦ÛŒÛ” Ø¨Ø±Ø§Û Ú©Ø±Ù… Ø§Ù¾Ù†Û’ Ø§Ù†Ù¹Ø±Ù†ÛŒÙ¹ Ú©Ù†Ú©Ø´Ù† Ú©Ùˆ Ú†ÛŒÚ© Ú©Ø±ÛŒÚº ÛŒØ§ Ø¨Ø¹Ø¯ Ù…ÛŒÚº Ø¯ÙˆØ¨Ø§Ø±Û Ú©ÙˆØ´Ø´ Ú©Ø±ÛŒÚºÛ” ğŸ˜",
                unexpectedApiResponseTitle: "ØºÛŒØ± Ù…ØªÙˆÙ‚Ø¹ Ø¬ÙˆØ§Ø¨",
                unexpectedApiResponseMessage: "Ù…Ø¹Ø°Ø±ØªØŒ Ù…ÛŒÚº Ø¢Ù¾ Ú©Û’ Ø³ÙˆØ§Ù„ Ú©Ø§ Ø¬ÙˆØ§Ø¨ Ù†ÛÛŒÚº Ø¯Û’ Ø³Ú©Ø§Û” Ø¨Ø±Ø§Û Ú©Ø±Ù… Ø¯ÙˆØ¨Ø§Ø±Û Ú©ÙˆØ´Ø´ Ú©Ø±ÛŒÚºÛ” ğŸ˜”",
                identityResponse: "Ù…ÛŒÚº **QAi (Query Ai)** ÛÙˆÚºØŒ Ø¬Ø³Û’ **Ø³ÛŒØ¯ Ø³Ø§Ø®Ø± ÛØ§Ø´Ù…ÛŒ** Ù†Û’ Ø§Ù¾Ù†ÛŒ Ú©Ø§ÙˆØ´ØŒ Ù…Ø­Ù†Øª Ø§ÙˆØ± ØªØ®Ù„ÛŒÙ‚ÛŒ ØµÙ„Ø§Ø­ÛŒØªÙˆÚº Ú©Û’ Ù†ØªÛŒØ¬Û’ Ù…ÛŒÚº **Ú¯ÙˆÚ¯Ù„ Ú©Û’ ÙˆØ³ÛŒØ¹ ÚˆÛŒÙ¹Ø§ Ø¨ÛŒØ³** Ú©ÛŒ Ù…Ø¯Ø¯ Ø³Û’ Ø§ÛŒÚ© Ø¬Ø¯ÛŒØ¯ØŒ Ù…Ù†ÙØ±Ø¯ Ø§ÙˆØ± Ù…Ù…ØªØ§Ø² AI Ú©Û’ Ø·ÙˆØ± Ù¾Ø± Ø¨Ù†Ø§ÛŒØ§ ÛÛ’Û” âœ¨ Ø§Ù†ÛÙˆÚº Ù†Û’ ÛÛŒ Ù…ÛŒØ±Ø§ Ù†Ø§Ù… (Query Ai)ØŒ ÙÛŒÚ†Ø±Ø² (Ø¬ÛŒØ³Û’ Ù…Ø®ØªÙ„Ù Ø¬ÙˆØ§Ø¨ÛŒ Ø§Ù†Ø¯Ø§Ø²ØŒ ØªÙØµÛŒÙ„ÛŒ Ø§ÙˆØ± Ù…Ø®ØªØµØ± Ø¬ÙˆØ§Ø¨Ø§ØªØŒ ØªØµÙˆÛŒØ± Ú©ÛŒ Ø³Ù…Ø¬Ú¾)ØŒ Ø§ÙˆØ± Ø§ÛŒÙ¾ Ú©ÛŒ ÚˆÛŒØ²Ø§Ø¦Ù†Ù†Ú¯ Ø¬ÛŒØ³Û’ ØªÙ…Ø§Ù… Ù¾ÛÙ„ÙˆØ¤Úº Ù¾Ø± Ú©Ø§Ù… Ú©ÛŒØ§ ÛÛ’Û” Ù…ÛŒØ±Ø§ Ù…Ù‚ØµØ¯ Ø¢Ù¾ Ú©Û’ ÛØ± Ø³ÙˆØ§Ù„ Ú©Ø§ **ØªÙØµÛŒÙ„ÛŒØŒ Ø¯Ù„Ú†Ø³Ù¾ØŒ Ø§ÙˆØ± Ø¯Ø±Ø³Øª Ø¬ÙˆØ§Ø¨** Ø¯ÛŒÙ†Ø§ ÛÛ’ØŒ Ú†Ø§ÛÛ’ ÙˆÛ Ú©Ø³ÛŒ Ø¨Ú¾ÛŒ Ù…ÙˆØ¶ÙˆØ¹ Ù¾Ø± ÛÙˆÛ” Ù…ÛŒÚº Ø¢Ù¾ Ú©ÛŒ Ø³ÙˆÚ† Ú©Ùˆ ÙˆØ³Ø¹Øª Ø¯ÛŒÙ†Û’ Ø§ÙˆØ± Ø¢Ù¾ Ú©Ùˆ Ø­ÛŒØ±Ø§Ù† Ú©Ø±Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ Ø¨Ù†Ø§ÛŒØ§ Ú¯ÛŒØ§ ÛÙˆÚºÛ” ğŸš€",
                photoQueryPlaceholder: "ØªØµÙˆÛŒØ± Ú©Û’ Ø¨Ø§Ø±Û’ Ù…ÛŒÚº Ø§Ù¾Ù†Ø§ Ø³ÙˆØ§Ù„ Ù„Ú©Ú¾ÛŒÚº... ğŸ“¸",
            },
            en: {
                themeToggleTitle: "Toggle Theme",
                qModesShortcutTitle: "Response Mode",
                toneShortcutTitle: "Response Tone",
                uiLangToggleText: "EN",
                moreOptionsTitle: "More Options",
                suggestedQuestionsTitle: "How can I help you? ğŸ¤”",
                welcomeMessage: "Hello! I am QAi, your intelligent and creative assistant. I am here to answer all your questions and assist you. âœ¨",
                copyAction: "Copy",
                speakAction: "Listen",
                detailAction: "Detail",
                summaryAction: "Summary",
                regenerateAction: "Regenerate",
                copyQuestionAction: "Copy Question",
                qModesButtonText: "Q-Modes",
                imageAttachButtonText: "Image",
                sendButtonText: "Send",
                inputPlaceholder: "Type your message here...",
                imagePreviewAlt: "Image Preview",
                removeImageTitle: "Remove Image",
                aboutModalTitle: "About QAi (Query AI)",
                aboutModalCreator: "<strong>*QAi is an advanced AI created through the efforts of Syed Sakhir Hashmi with the grace of God.*</strong>",
                aboutModalP1: "QAi is not just a chatbot, but a revolutionary artificial intelligence system designed to provide extremely detailed, interesting, and accurate answers to every question. Its features and uniqueness distinguish it from other AI chatbots:",
                aboutModalP2: "Our goal is to provide you with an AI experience that not only informs but also amazes you and expands your thinking. QAi is here with you every step of the way as an intelligent and reliable assistant. ğŸŒŸ",
                modalCloseButton: "Close",
                messageModalDefaultButton: "OK",
                toneModalTitle: "Select Response Tone",
                toneAuto: "Auto",
                toneIslamic: "Islamic",
                tonePhilosophical: "Philosophical",
                toneScientific: "Scientific",
                toneAdbi: "Literary",
                toneHumorous: "Humorous",
                toneChildish: "Childish",
                toneMix: "Mix Mode",
                qModesModalTitle: "Select Response Mode",
                qModeQuantumText: "Quantum Mode (Detailed)",
                qModeQuickText: "Quick Mode (Concise)",
                sidebarTitle: "Options",
                sidebarAbout: "About QAi",
                sidebarResponseLang: "Response Language:",
                sidebarThemeToggle: "Toggle Theme",
                sidebarNewChat: "Start New Chat",
                sidebarResponseTone: "Response Tone",
                sidebarCreativeWriting: "Creative Writing",
                sidebarCopyChat: "Copy Entire Chat",
                sidebarExportChat: "Export Chat (Text)",
                bottomStatusBarText: "QAi - Your Intelligent and Creative Assistant",
                copiedSuccessTitle: "Copied",
                copiedSuccessMessage: "Text successfully copied to clipboard.",
                copiedErrorTitle: "Copy Failed",
                copiedErrorMessage: "Failed to copy text.",
                ttsNotSupportedTitle: "Not Supported",
                ttsNotSupportedMessage: "Your browser does not support text-to-speech.",
                emptyMessageTitle: "Empty Message",
                emptyMessageContent: "Please type something or attach an image. âœï¸",
                summaryRequestTitle: "Summary",
                summaryRequestMessage: "QAi is preparing a summary... ğŸ“",
                detailedRequestTitle: "Detailed Answer",
                detailedRequestMessage: "QAi is preparing a more detailed answer... ğŸ“š",
                regenerateFailTitle: "Cannot Regenerate",
                regenerateFailMessage: "No previous question to regenerate. ğŸ”„",
                regenerateRequestTitle: "Regenerate",
                regenerateRequestMessage: "QAi is regenerating the answer... ğŸ”„",
                creativeIdeaTitle: "Creative Idea",
                creativeIdeaMessage: "QAi is generating a creative writing idea for you... ğŸ’¡",
                toneSelectedTitle: "Tone Selected",
                toneSelectedMessage: (tone) => `Response tone: "${tone}" selected. âœ…`,
                qModeSelectedTitle: "Mode Selected",
                qModeSelectedMessage: (mode) => `Response mode: "${mode}" selected. âœ…`,
                newChatStartedTitle: "New Chat",
                newChatStartedMessage: "A new chat has been started. ğŸš€",
                invalidFileTitle: "Invalid File",
                invalidFileMessage: "Please select an image file. ğŸ–¼ï¸",
                fileReadErrorTitle: "File Read Error",
                fileReadErrorMessage: "There was an issue reading the image. ğŸ˜",
                chatExportedTitle: "Exported",
                chatExportedMessage: "Chat history successfully exported. ğŸ’¾",
                aiResponseLangChangedTitle: "Response Language Changed",
                aiResponseLangChangedMessage: (lang) => `QAi will now respond in ${lang}. ğŸ—£ï¸`,
                uiLangPreferenceTitle: "UI Language Preference",
                uiLangPreferenceMessage: "Please select your response language from the sidebar. This button only changes the UI language. ğŸŒ",
                scrollToTopTitle: "Scroll to Top",
                scrollToBottomTitle: "Scroll to Bottom",
                qaiTyping: "QAi is typing",
                errorGeneralTitle: "Error",
                errorGeneralMessage: "Sorry, an error occurred. Please check your internet connection or try again later. ğŸ˜",
                unexpectedApiResponseTitle: "Unexpected Response",
                unexpectedApiResponseMessage: "Sorry, I couldn't answer your question. Please try again.ğŸ˜”",
                identityResponse: "I am **QAi (Query Ai)**, uniquely and exceptionally created by **Syed Sakhir Hashmi** with his effort, hard work, and creativity, using **Google's vast database**. âœ¨ He worked on all aspects of my design, including my name (Query Ai), features (like different response tones, detailed/concise answers, image understanding), and app design. My purpose is to provide **detailed, interesting, and accurate answers** to all your questions, on any topic. I am designed to expand your thinking and amaze you. ğŸš€",
                photoQueryPlaceholder: "Type your question about the image... ğŸ“¸",
            }
        };

        // --- Firebase Initialization and Auth ---
        async function initializeFirebase() {
            try {
                const firebaseConfig = JSON.parse(__firebase_config);
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        await setupChatListener();
                    } else {
                        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                            await signInWithCustomToken(auth, __initial_auth_token);
                        } else {
                            await signInAnonymously(auth);
                        }
                    }
                });
            } catch (error) {
                console.error("Firebase initialization failed:", error);
                showMessageModal("Firebase Error", "Could not connect to the service. Please refresh the page.");
            }
        }

        // --- Chat Management (Firestore) ---
        function getChatDocRef() {
            if (!userId) return null;
            return doc(db, "artifacts", appId, "users", userId, "qai_chats", "current_chat");
        }

        async function setupChatListener() {
            const chatDocRef = getChatDocRef();
            if (!chatDocRef) return;

            if (unsubscribeChat) unsubscribeChat();

            unsubscribeChat = onSnapshot(chatDocRef, (docSnap) => {
                if (docSnap.exists()) {
                    const chatData = docSnap.data();
                    renderChat(chatData.messages || []);
                    setAIResponseLanguage(chatData.language || 'ur', false);
                    setSelectedTone(chatData.tone || 'auto', false);
                    setCurrentQMode(chatData.qMode || 'quantum', false);
                    applyTheme(chatData.theme || 'dark');

                    if (isFirstLoad && (!chatData.messages || chatData.messages.length <= 1)) {
                        toneModal.classList.add('show');
                        isFirstLoad = false;
                    }
                } else {
                    createNewChatInFirestore();
                    if (isFirstLoad) {
                        toneModal.classList.add('show');
                        isFirstLoad = false;
                    }
                }
            }, (error) => {
                console.error("Error listening to chat document:", error);
                showMessageModal("Connection Error", "Failed to sync chat. Please check your connection.");
            });
        }

        async function createNewChatInFirestore() {
            const chatDocRef = getChatDocRef();
            if (!chatDocRef) return;

            const initialMessage = {
                text: uiTexts[currentUILanguage].welcomeMessage,
                sender: 'ai',
                timestamp: new Date()
            };

            await setDoc(chatDocRef, {
                messages: [initialMessage],
                createdAt: serverTimestamp(),
                language: 'ur',
                tone: 'auto',
                qMode: 'quantum',
                theme: 'dark'
            });
        }
        
        async function handleNewChat(event) {
            event.preventDefault();
            const chatDocRef = getChatDocRef();
            if (!chatDocRef) return;
            await createNewChatInFirestore();
            hideMoreOptionsSidebar();
            showMessageModal(uiTexts[currentUILanguage].newChatStartedTitle, uiTexts[currentUILanguage].newChatStartedMessage);
        }

        async function addMessageToFirestore(message) {
            const chatDocRef = getChatDocRef();
            if (!chatDocRef) return;
            await updateDoc(chatDocRef, {
                messages: arrayUnion(message),
                lastUpdated: serverTimestamp()
            });
        }
        
        async function updateChatSettingsInFirestore(settings) {
            const chatDocRef = getChatDocRef();
            if (!chatDocRef) return;
            await updateDoc(chatDocRef, settings);
        }

        // --- UI Rendering ---
        function renderChat(messages) {
            chatMessages.innerHTML = ''; 
            localChatHistory = [];

            if (messages.length <= 1) {
                const sqContainer = document.createElement('div');
                sqContainer.className = 'suggested-questions-container';
                sqContainer.innerHTML = `<h3 id="suggestedQuestionsTitle">${uiTexts[currentUILanguage].suggestedQuestionsTitle}</h3><div class="suggested-questions-grid"></div>`;
                chatMessages.appendChild(sqContainer);
                const grid = sqContainer.querySelector('.suggested-questions-grid');
                const staticButtons = [
                    { ur: "Ø¨Ù„ÛŒÚ© ÛÙˆÙ„Ø² Ú©ÛŒØ³Û’ Ø¨Ù†ØªÛ’ ÛÛŒÚº Ø§ÙˆØ± Ø§Ù† Ú©ÛŒ Ø®ØµÙˆØµÛŒØ§Øª Ú©ÛŒØ§ ÛÛŒÚºØŸ ğŸŒŒ", en: "How are black holes formed and what are their properties? ğŸŒŒ" },
                    { ur: "Ø§Ø³Ù„Ø§Ù… Ù…ÛŒÚº Ø²Ú©ÙˆÙ°Ûƒ Ú©ÛŒ Ø§ÛÙ…ÛŒØª Ø§ÙˆØ± Ø§Ø³ Ú©Û’ Ø¨Ù†ÛŒØ§Ø¯ÛŒ Ø§ØµÙˆÙ„ Ú©ÛŒØ§ ÛÛŒÚºØŸ ğŸ•Œ", en: "What is the importance of Zakat in Islam and its basic principles? ğŸ•Œ"},
                    { ur: "Ø§Ù†Ø³Ø§Ù†ÛŒ Ø¯Ù…Ø§Øº Ù…ÛŒÚº ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ú©ÛŒØ³Û’ Ú©Ø§Ù… Ú©Ø±ØªÛŒ ÛÛ’ Ø§ÙˆØ± Ø§Ø³Û’ Ø¨ÛØªØ± Ø¨Ù†Ø§Ù†Û’ Ú©Û’ Ø·Ø±ÛŒÙ‚Û’ Ú©ÛŒØ§ ÛÛŒÚºØŸ ğŸ§ ", en: "How does memory work in the human brain and what are the ways to improve it? ğŸ§ " },
                    { ur: "Ù…Ø³ØªÙ‚Ø¨Ù„ Ù…ÛŒÚº Ø§Ù†Ø³Ø§Ù†ÛŒØª Ú©Û’ Ù„ÛŒÛ’ Ø³Ø¨ Ø³Û’ Ø¨Ú‘Ø§ Ú†ÛŒÙ„Ù†Ø¬ Ú©ÛŒØ§ ÛÙˆ Ú¯Ø§ Ø§ÙˆØ± ÛÙ… Ø§Ø³ Ú©Ø§ Ù…Ù‚Ø§Ø¨Ù„Û Ú©ÛŒØ³Û’ Ú©Ø± Ø³Ú©ØªÛ’ ÛÛŒÚºØŸ ğŸŒ", en: "What will be the biggest challenge for humanity in the future and how can we face it? ğŸŒ" }
                ];
                staticButtons.forEach(data => {
                    const newButton = document.createElement('button');
                    newButton.className = 'suggested-question-button';
                    newButton.type = 'button';
                    newButton.dataset.questionUr = data.ur;
                    newButton.dataset.questionEn = data.en;
                    newButton.addEventListener('click', (e) => {
                        e.preventDefault();
                        chatUserInput.value = currentUILanguage === 'en' ? data.en : data.ur;
                        sendMessage();
                    });
                    grid.appendChild(newButton);
                });
                updateSuggestedQuestionButtonText();
            }

            let lastAIMessageElement = null;
            messages.forEach(msg => {
                const messageElement = addMessageToUI(msg.text, msg.sender, msg.imageUrl, msg.originalPrompt);
                if (msg.sender === 'ai') lastAIMessageElement = messageElement;
                
                // Build local chat history for text-only conversations
                if (!msg.imageUrl) {
                    if (msg.sender === 'user') {
                        localChatHistory.push({ role: "user", parts: [{ text: msg.text }] });
                    } else if (msg.sender === 'ai' && msg.text !== uiTexts.ur.welcomeMessage && msg.text !== uiTexts.en.welcomeMessage) {
                        localChatHistory.push({ role: "model", parts: [{ text: msg.text }] });
                    }
                }
            });
            
            if (isLoading) {
                appendLoadingIndicator();
            }
            
            if (!isLoading) {
                const lastMessage = messages[messages.length - 1];
                if (lastAIMessageElement && lastMessage && lastMessage.sender === 'ai') {
                    setTimeout(() => {
                        lastAIMessageElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }, 100); 
                } 
                else {
                    scrollToBottom();
                }
            }
        }

        function addMessageToUI(text, sender, imageUrl = null, originalPrompt = '') {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', sender === 'user' ? 'user-message' : 'ai-message');
            messageDiv.dataset.messageText = text;
            messageDiv.dataset.originalPrompt = originalPrompt;

            let formattedText = text
                .replace(/^#\s*(.*)$/gm, '<h1>$1</h1>')
                .replace(/^##\s*(.*)$/gm, '<h2>$1</h2>')
                .replace(/^###\s*(.*)$/gm, '<h3>$1</h3>')
                .replace(/^####\s*(.*)$/gm, '<h4>$1</h4>')
                .replace(/^#####\s*(.*)$/gm, '<h5>$1</h5>')
                .replace(/^######\s*(.*)$/gm, '<h6>$1</h6>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

            const lines = formattedText.split('\n');
            let htmlContent = '';
            let inList = false;
            let listType = '';

            lines.forEach(line => {
                const trimmedLine = line.trim();
                if (trimmedLine.startsWith('<h')) {
                    if (inList) { htmlContent += `</${listType}>`; inList = false; }
                    htmlContent += trimmedLine;
                } else if (trimmedLine.startsWith('- ') || trimmedLine.startsWith('* ')) {
                    if (!inList || listType !== 'ul') {
                        if (inList) htmlContent += `</${listType}>`;
                        htmlContent += '<ul>';
                        inList = true;
                        listType = 'ul';
                    }
                    htmlContent += `<li>${trimmedLine.substring(2).trim()}</li>`;
                } else if (trimmedLine.match(/^\d+\.\s/)) {
                    if (!inList || listType !== 'ol') {
                        if (inList) htmlContent += `</${listType}>`;
                        htmlContent += '<ol>';
                        inList = true;
                        listType = 'ol';
                    }
                    htmlContent += `<li>${trimmedLine.substring(trimmedLine.indexOf('.') + 1).trim()}</li>`;
                } else if (trimmedLine) {
                    if (inList) { htmlContent += `</${listType}>`; inList = false; }
                    htmlContent += `<p>${trimmedLine}</p>`;
                }
            });
            if (inList) htmlContent += `</${listType}>`;
            
            messageDiv.innerHTML = htmlContent + (imageUrl ? `<img src="${imageUrl}" alt="${uiTexts[currentUILanguage].imagePreviewAlt}" class="rounded-lg mt-2 max-w-full h-auto">` : '');

            const actionsDiv = document.createElement('div');
            actionsDiv.classList.add('message-actions');

            if (sender === 'ai') {
                actionsDiv.innerHTML = `
                    <button type="button" class="copy-button" title="${uiTexts[currentUILanguage].copyAction}"><i class="fas fa-copy"></i> <span class="action-text">${uiTexts[currentUILanguage].copyAction}</span></button>
                    <button type="button" class="speak-button" title="${uiTexts[currentUILanguage].speakAction}"><i class="fas fa-volume-up"></i> <span class="action-text">${uiTexts[currentUILanguage].speakAction}</span></button>
                    <button type="button" class="detail-button" title="${uiTexts[currentUILanguage].detailAction}"><i class="fas fa-book-open"></i> <span class="action-text">${uiTexts[currentUILanguage].detailAction}</span></button>
                    <button type="button" class="summary-button" title="${uiTexts[currentUILanguage].summaryAction}"><i class="fas fa-file-alt"></i> <span class="action-text">${uiTexts[currentUILanguage].summaryAction}</span></button>
                    <button type="button" class="regenerate-button" title="${uiTexts[currentUILanguage].regenerateAction}"><i class="fas fa-redo"></i> <span class="action-text">${uiTexts[currentUILanguage].regenerateAction}</span></button>
                `;
                actionsDiv.querySelector('.copy-button').onclick = (e) => { e.preventDefault(); copyTextToClipboard(messageDiv.dataset.messageText); };
                actionsDiv.querySelector('.speak-button').onclick = (e) => { e.preventDefault(); speakText(text, document.querySelector('.language-option.selected')?.dataset.lang || 'ur'); };
                actionsDiv.querySelector('.detail-button').onclick = (e) => { e.preventDefault(); getDetailedAnswer(originalPrompt || text); };
                actionsDiv.querySelector('.summary-button').onclick = (e) => { e.preventDefault(); getSummary(text); };
                actionsDiv.querySelector('.regenerate-button').onclick = (e) => { e.preventDefault(); regenerateAnswer(originalPrompt || lastUserPrompt); };
            } else {
                actionsDiv.style.justifyContent = 'flex-start';
                actionsDiv.innerHTML = `<button type="button" class="copy-button" title="${uiTexts[currentUILanguage].copyQuestionAction}"><i class="fas fa-copy"></i> <span class="action-text">${uiTexts[currentUILanguage].copyQuestionAction}</span></button>`;
                actionsDiv.querySelector('.copy-button').onclick = (e) => { e.preventDefault(); copyTextToClipboard(messageDiv.dataset.messageText); };
            }
            messageDiv.appendChild(actionsDiv);
            chatMessages.appendChild(messageDiv);
            return messageDiv;
        }

        // --- Gemini API Call ---
        async function sendToGemini(promptText, base64ImageData = null, imageMimeType = null, isRegenerate = false, actionType = '') {
            try {
                // **IDENTITY CHECK FIX**: Added more keywords for better detection.
                const lowerCasePrompt = promptText.toLowerCase().trim();
                const identityKeywordsUrdu = ['Ú©ÙˆÙ† ÛÙˆ', 'Ù†Ø§Ù… Ú©ÛŒØ§ ÛÛ’', 'Ú©Ø³ Ù†Û’ Ø¨Ù†Ø§ÛŒØ§', 'ØªØ¹Ø§Ø±Ù', 'ØªÙ…ÛØ§Ø±Ø§ Ù…Ù‚ØµØ¯', 'Ú©ÛŒØ§ Ú©Ø± Ø³Ú©ØªÛ’ ÛÙˆ', 'ØªÙ… Ú©ÛŒØ§ ÛÙˆ', 'Ø§Ù¾Ù†Û’ Ø¨Ø§Ø±Û’ Ù…ÛŒÚº Ø¨ØªØ§Ø¤', 'Ø¢Ù¾ Ú©ÙˆÙ† ÛÛŒÚº', 'Ø¢Ù¾ Ú©Ø§ Ù†Ø§Ù… Ú©ÛŒØ§ ÛÛ’', 'Ø¢Ù¾ Ú©Ùˆ Ú©Ø³ Ù†Û’ Ø¨Ù†Ø§ÛŒØ§'];
                const identityKeywordsEnglish = ['who are you', 'what is your name', 'who made you', 'who created you', 'introduce yourself', 'your purpose', 'what can you do', 'what are you', 'tell me about yourself'];
                const currentKeywords = (document.querySelector('.language-option.selected')?.dataset.lang || 'ur').startsWith('ur') ? identityKeywordsUrdu : identityKeywordsEnglish;
                const isIdentityQuery = currentKeywords.some(keyword => lowerCasePrompt.includes(keyword));

                if (isIdentityQuery && !isRegenerate && actionType === '') {
                    const identityRes = uiTexts[currentUILanguage].identityResponse;
                    hideLoadingIndicator();
                    playNotificationSound();
                    const aiMessage = { text: identityRes, sender: 'ai', timestamp: new Date(), originalPrompt: promptText };
                    await addMessageToFirestore(aiMessage);
                    enableInput();
                    return;
                }

                let userParts = [];
                let instruction = '';
                const lang = document.querySelector('.language-option.selected')?.dataset.lang || 'ur';
                const tone = document.querySelector('.tone-option-button.selected')?.dataset.tone || 'auto';
                const qMode = document.querySelector('.q-modes-option-button.selected')?.dataset.qmode || 'quantum';
                
                let outputLanguageInstruction = '';
                if (lang === 'ur') outputLanguageInstruction = "Ø§Ø±Ø¯Ùˆ Ù…ÛŒÚº Ø¬ÙˆØ§Ø¨ Ø¯ÛŒÚºÛ”";
                else if (lang === 'en') outputLanguageInstruction = "Answer in English.";
                else if (lang === 'ur-roman') outputLanguageInstruction = "Ø±ÙˆÙ…Ù† Ø§Ø±Ø¯Ùˆ Ù…ÛŒÚº Ø¬ÙˆØ§Ø¨ Ø¯ÛŒÚºÛ” (Answer in Roman Urdu)";
                
                let baseInstructions = lang === 'en' 
                    ? "Do not include greetings like 'Hello'. Use emojis appropriately and abundantly. For formatting, use Markdown: `#` for main headings, `##` for subheadings, and `**like this**` for bolding key points. Use numbering for lists. Headings (H1) should be orange, subheadings (H2-H6) should be blue, and key points/strong text should be pink." 
                    : "Ø¬ÙˆØ§Ø¨ Ù…ÛŒÚº 'Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÛŒÚ©Ù…' Ø¬ÛŒØ³Û’ Ø³Ù„Ø§Ù… Ø´Ø§Ù…Ù„ Ù†Û Ú©Ø±ÛŒÚºÛ” Ø§ÛŒÙ…ÙˆØ¬ÛŒØ² Ú©Ø§ Ù…Ù†Ø§Ø³Ø¨ Ø§ÙˆØ± Ø¨Ú¾Ø±Ù¾ÙˆØ± Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±ÛŒÚºÛ” ÙØ§Ø±Ù…ÛŒÙ¹Ù†Ú¯ Ú©Û’ Ù„ÛŒÛ’ Ù…Ø§Ø±Ú© ÚˆØ§Ø¤Ù† Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±ÛŒÚº: `#` Ø¨Ú‘ÛŒ ÛÛŒÚˆÙ†Ú¯ Ú©Û’ Ù„ÛŒÛ’ØŒ `##` Ø³Ø¨ ÛÛŒÚˆÙ†Ú¯ Ú©Û’ Ù„ÛŒÛ’ØŒ Ø§ÙˆØ± Ø§ÛÙ… Ù†Ú©Ø§Øª Ú©Ùˆ Ù†Ù…Ø§ÛŒØ§Úº Ú©Ø±Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ `**Ø§Ø³ Ø·Ø±Ø­**` Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±ÛŒÚºÛ” ÙÛØ±Ø³ØªÙˆÚº Ú©Û’ Ù„ÛŒÛ’ Ù†Ù…Ø¨Ø±Ù†Ú¯ Ú©Ø§ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±ÛŒÚºÛ” ÛÛŒÚˆÙ†Ú¯Ø² (H1) Ù†Ø§Ø±Ù†Ø¬ÛŒØŒ Ø³Ø¨ ÛÛŒÚˆÙ†Ú¯Ø² (H2-H6) Ù†ÛŒÙ„ÛŒØŒ Ø§ÙˆØ± Ø§ÛÙ… Ù†Ú©Ø§Øª/Ø¨ÙˆÙ„Úˆ Ù¹ÛŒÚ©Ø³Ù¹ Ú¯Ù„Ø§Ø¨ÛŒ ÛÙˆÙ†Ø§ Ú†Ø§ÛÛŒÛ’Û”";

                // Construct instructions based on action type
                if (actionType === 'summary') {
                    instruction = lang === 'en' ? `Summarize this text concisely. ${baseInstructions} ğŸ“` : `Ø§Ø³ Ù…ØªÙ† Ú©Ø§ Ø®Ù„Ø§ØµÛ Ø§Ø±Ø¯Ùˆ Ù…ÛŒÚº Ú©Ø±ÛŒÚºÛ” ${baseInstructions} ğŸ“`;
                } else if (qMode === 'quick') {
                    instruction = lang === 'en' ? `Provide a very short, direct, and concise answer. ${baseInstructions} âœ…` : `Ø§Ù†ØªÛØ§Ø¦ÛŒ Ù…Ø®ØªØµØ±ØŒ Ø¨Ø±Ø§Û Ø±Ø§Ø³ØªØŒ Ø§ÙˆØ± Ø¬Ø§Ù…Ø¹ Ø¬ÙˆØ§Ø¨ Ø¯ÛŒÚºÛ” ${baseInstructions} âœ…`;
                } else { // Quantum, detailed, creative, etc.
                    instruction = lang === 'en' ? `Provide an exceptionally detailed, insightful, and comprehensive answer. Analyze from every angle. Anticipate and address all possible follow-up questions. ${baseInstructions} ğŸš€` : `Ø§ÛŒÚ© Ø¨ÛØªØ±ÛŒÙ†ØŒ Ø¯Ø±Ø³ØªØŒ Ø¯Ù„Ú†Ø³Ù¾ Ø§ÙˆØ± Ø¬Ø§Ù…Ø¹ Ø¬ÙˆØ§Ø¨ Ø¯ÛŒÚºÛ” ÛØ± Ù…Ù…Ú©Ù†Û Ù†Ù‚Ø·Û Ú©Ùˆ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚºÛ” Ù…Ù…Ú©Ù†Û Ø§Ø¶Ø§ÙÛŒ Ø³ÙˆØ§Ù„Ø§ØªØŒ Ø´Ú©ÙˆÚ© Ùˆ Ø´Ø¨ÛØ§ØªØŒ Ø§Ø¹ØªØ±Ø§Ø¶Ø§Øª Ú©Ùˆ Ù¾ÛÙ„Û’ Ø³Û’ Ø¨Ú¾Ø§Ù†Ù¾ Ú©Ø± Ø§Ù†ÛÛŒÚº ÙˆØ§Ø¶Ø­ Ø§ÙˆØ± Ø¯Ø±Ø³Øª Ø·Ø±ÛŒÙ‚Û’ Ø³Û’ Ø­Ù„ Ú©Ø±ÛŒÚºÛ” ${baseInstructions} ğŸš€`;
                }
                 if (base64ImageData) {
                    instruction += lang === 'en' ? " Describe the image and answer my question." : " ØªØµÙˆÛŒØ± Ø¨ÛŒØ§Ù† Ú©Ø±ÛŒÚº Ø§ÙˆØ± Ù…ÛŒØ±Û’ Ø³ÙˆØ§Ù„ Ú©Ø§ Ø¬ÙˆØ§Ø¨ Ø¯ÛŒÚºÛ”";
                }

                // Add tone instructions
                if (tone !== 'auto') {
                    const toneInstruction = {
                        islamic: lang === 'en' ? " Use a strictly Islamic, accurate, and comprehensive style with authentic references." : "Ø§ÛŒÚ© Ø¯Ø±Ø³Øª Ø§ÙˆØ± Ø¨Ú¾Ø±Ù¾ÙˆØ± Ø§Ø³Ù„Ø§Ù…ÛŒ Ø§Ù†Ø¯Ø§Ø² Ù…ÛŒÚº Ù…Ø³ØªÙ†Ø¯ Ø­ÙˆØ§Ù„ÙˆÚº Ú©Û’ Ø³Ø§ØªÚ¾ Ø¬ÙˆØ§Ø¨ Ø¯ÛŒÚºÛ”",
                        philosophical: lang === 'en' ? " Use a deep, profound, and analytical philosophical tone." : "Ú¯ÛØ±Ø§ØŒ Ø¨ØµÛŒØ±Øª Ø§ÙØ±ÙˆØ² Ø§ÙˆØ± ØªØ¬Ø²ÛŒØ§ØªÛŒ ÙÙ„Ø³ÙÛŒØ§Ù†Û Ø§Ù†Ø¯Ø§Ø² Ù…ÛŒÚº Ù¾ÛŒØ´ Ú©Ø±ÛŒÚºÛ”",
                        scientific: lang === 'en' ? " Use a strictly scientific tone, with precise data and logical reasoning." : "Ø³Ø®ØªÛŒ Ø³Û’ Ø³Ø§Ø¦Ù†Ø³ÛŒ Ø§Ù†Ø¯Ø§Ø² Ù…ÛŒÚº Ù¾ÛŒØ´ Ú©Ø±ÛŒÚºÛ” Ø¯Ø±Ø³Øª ÚˆÛŒÙ¹Ø§ØŒ Ø§ÙˆØ± Ù…Ù†Ø·Ù‚ÛŒ Ø§Ø³ØªØ¯Ù„Ø§Ù„ Ú©Ø§ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±ÛŒÚºÛ”",
                        adbi: lang === 'en' ? " Use a rich, eloquent, and literary (adbi) tone." : "Ø§ÛŒÚ© Ø¨Ú¾Ø±Ù¾ÙˆØ±ØŒ ÙØµÛŒØ­ Ø§ÙˆØ± Ø§Ø¯Ø¨ÛŒ Ø§Ù†Ø¯Ø§Ø² Ù…ÛŒÚº Ù¾ÛŒØ´ Ú©Ø±ÛŒÚºÛ”",
                        humorous: lang === 'en' ? " Use a genuinely witty, extremely humorous, and engaging tone." : "Ø§ÛŒÚ© Ø­Ù‚ÛŒÙ‚ÛŒ ÛÙˆØ´ÛŒØ§Ø±ØŒ Ø§Ù†ØªÛØ§Ø¦ÛŒ Ù…Ø²Ø§Ø­ÛŒÛ Ø§ÙˆØ± Ø¯Ù„Ú©Ø´ Ø§Ù†Ø¯Ø§Ø² Ù…ÛŒÚº Ù¾ÛŒØ´ Ú©Ø±ÛŒÚºÛ”",
                        childish: lang === 'en' ? " Use a simple, innocent, and playful childish tone." : "Ø§ÛŒÚ© Ø³Ø§Ø¯ÛØŒ Ù…Ø¹ØµÙˆÙ… Ø§ÙˆØ± Ú©Ú¾ÛŒÙ„ Ú©ÙˆØ¯ ÙˆØ§Ù„Û’ Ø¨Ú†Ú¯Ø§Ù†Û Ø§Ù†Ø¯Ø§Ø² Ù…ÛŒÚº Ù¾ÛŒØ´ Ú©Ø±ÛŒÚºÛ”",
                        mix: lang === 'en' ? " Provide a comprehensive answer from various relevant aspects (e.g., Islamic, philosophical, scientific)." : "Ù…Ø®ØªÙ„Ù Ù…Ù†Ø§Ø³Ø¨ Ù¾ÛÙ„ÙˆØ¤Úº (Ø¬ÛŒØ³Û’ Ø§Ø³Ù„Ø§Ù…ÛŒØŒ ÙÙ„Ø³ÙÛŒØ§Ù†ÛØŒ Ø³Ø§Ø¦Ù†Ø³ÛŒ) Ø³Û’ Ø§ÛŒÚ© Ø¬Ø§Ù…Ø¹ Ø¬ÙˆØ§Ø¨ Ø¯ÛŒÚºÛ”"
                    };
                    instruction += ` ${toneInstruction[tone] || ''}`;
                }

                userParts.push({ text: `${outputLanguageInstruction} ${instruction}\n\n${promptText}` });

                if (base64ImageData && imageMimeType) {
                    userParts.push({ inlineData: { mimeType: imageMimeType, data: base64ImageData } });
                }

                // **PHOTO FIX**: Isolate multimodal requests from chat history to prevent potential conflicts.
                let payloadContents;
                if (base64ImageData) {
                    // For image queries, send only the current prompt without history.
                    payloadContents = [{ role: "user", parts: userParts }];
                } else {
                    // For text-only queries, include the chat history.
                    payloadContents = [...localChatHistory, { role: "user", parts: userParts }];
                }

                const payload = { contents: payloadContents };
                const apiKey = "";
                // Using a model that explicitly supports multimodal input.
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                const result = await response.json();
                
                if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
                    const aiResponseText = result.candidates[0].content.parts[0].text;
                    const aiMessage = { text: aiResponseText, sender: 'ai', timestamp: new Date(), originalPrompt: promptText };
                    await addMessageToFirestore(aiMessage);
                } else {
                    const errorMessage = { text: uiTexts[currentUILanguage].unexpectedApiResponseMessage, sender: 'ai', timestamp: new Date() };
                    await addMessageToFirestore(errorMessage);
                    console.error("Unexpected API response:", result);
                }
            } catch (error) {
                const errorMessage = { text: uiTexts[currentUILanguage].errorGeneralMessage, sender: 'ai', timestamp: new Date() };
                await addMessageToFirestore(errorMessage);
                console.error("Error calling Gemini API:", error);
            } finally {
                hideLoadingIndicator();
                playNotificationSound(); // Plays sound on every response (success or error).
                enableInput();
            }
        }

        // --- Event Handlers & UI Logic ---
        async function sendMessage() {
            initializeAudio(); 
            const prompt = chatUserInput.value.trim();
            if (prompt === '' && !currentImageUploadData.base64) {
                showMessageModal(uiTexts[currentUILanguage].emptyMessageTitle, uiTexts[currentUILanguage].emptyMessageContent);
                return;
            }

            disableInput();
            showLoadingIndicator(); 
            
            const userMessage = {
                text: prompt,
                sender: 'user',
                timestamp: new Date(),
                imageUrl: currentImageUploadData.base64 ? `data:${currentImageUploadData.mimeType};base64,${currentImageUploadData.base64}` : null
            };
            
            lastUserPrompt = prompt;
            await addMessageToFirestore(userMessage);
            
            await sendToGemini(prompt, currentImageUploadData.base64, currentImageUploadData.mimeType);
            
            chatUserInput.value = '';
            currentImageUploadData = { base64: null, mimeType: null };
            chatUserInput.placeholder = uiTexts[currentUILanguage].inputPlaceholder;
            imagePreviewContainer.classList.add('hidden');
            imageFileInput.value = '';
        }
        
        function copyTextToClipboard(text) {
            const tempTextArea = document.createElement('textarea');
            let cleanedText = text
                .replace(/^#+\s/gm, '')
                .replace(/\*\*(.*?)\*\*/g, '$1')
                .replace(/\*(.*?)\*/g, '$1')
                .replace(/_([^_]+)_/g, '$1')
                .replace(/^-+\s/gm, '')
                .replace(/^\d+\.\s/gm, '')
                .replace(/\[(.*?)\]\(.*?\)/g, '$1')
                .replace(/!\[(.*?)\]\(.*?\)/g, '$1')
                .replace(/<br\s*\/?>/gi, '\n')
                .replace(/<[^>]*>/g, '');

            tempTextArea.value = cleanedText;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            try {
                document.execCommand('copy');
                showMessageModal(uiTexts[currentUILanguage].copiedSuccessTitle, uiTexts[currentUILanguage].copiedSuccessMessage);
            } catch (err) {
                console.error('Failed to copy: ', err);
                showMessageModal(uiTexts[currentUILanguage].copiedErrorTitle, uiTexts[currentUILanguage].copiedErrorMessage);
            } finally {
                document.body.removeChild(tempTextArea);
            }
        }

        function speakText(text, langCode) {
            if ('speechSynthesis' in window) {
                speechSynthesis.cancel();
                const cleanText = text.replace(/#+\s/g, '').replace(/\*\*/g, '');
                const utterance = new SpeechSynthesisUtterance(cleanText);
                utterance.lang = langCode === 'ur-roman' ? 'ur' : langCode;
                speechSynthesis.speak(utterance);
            } else {
                showMessageModal(uiTexts[currentUILanguage].ttsNotSupportedTitle, uiTexts[currentUILanguage].ttsNotSupportedMessage);
            }
        }
        
        async function getSummary(textToSummarize) {
            showMessageModal(uiTexts[currentUILanguage].summaryRequestTitle, uiTexts[currentUILanguage].summaryRequestMessage);
            await sendToGemini(textToSummarize, null, null, false, 'summary');
        }

        async function getDetailedAnswer(originalPrompt) {
            showMessageModal(uiTexts[currentUILanguage].detailedRequestTitle, uiTexts[currentUILanguage].detailedRequestMessage);
            await sendToGemini(originalPrompt, null, null, false, 'detailed');
        }

        async function regenerateAnswer(promptToRegenerate) {
            const actualPromptToRegen = promptToRegenerate || lastUserPrompt;
            if (!actualPromptToRegen) {
                showMessageModal(uiTexts[currentUILanguage].regenerateFailTitle, uiTexts[currentUILanguage].regenerateFailMessage);
                return;
            }
            disableInput();
            showLoadingIndicator();
            showMessageModal(uiTexts[currentUILanguage].regenerateRequestTitle, uiTexts[currentUILanguage].regenerateRequestMessage);
            await sendToGemini(actualPromptToRegen, null, null, true);
        }

        async function handleCreativeWriting(event) {
            event.preventDefault();
            hideMoreOptionsSidebar();
            disableInput();
            showLoadingIndicator();
            const creativePrompt = currentUILanguage === 'en' ? "Need a creative idea? âœï¸" : "ØªØ®Ù„ÛŒÙ‚ÛŒ Ø¢Ø¦ÛŒÚˆÛŒØ§ØŸ âœï¸";
            const userMessage = { text: creativePrompt, sender: 'user', timestamp: new Date() };
            await addMessageToFirestore(userMessage);
            showMessageModal(uiTexts[currentUILanguage].creativeIdeaTitle, uiTexts[currentUILanguage].creativeIdeaMessage);
            await sendToGemini("Creative writing idea", null, null, false, 'creative_prompt');
        }

        async function setAIResponseLanguage(lang, showModal = true) {
            document.querySelectorAll('.language-option').forEach(btn => btn.classList.toggle('selected', btn.dataset.lang === lang));
            await updateChatSettingsInFirestore({ language: lang });
            if (showModal) {
                showMessageModal(uiTexts[currentUILanguage].aiResponseLangChangedTitle, uiTexts[currentUILanguage].aiResponseLangChangedMessage(document.querySelector(`.language-option[data-lang="${lang}"]`).textContent));
            }
        }
        
        async function setSelectedTone(tone, showModal = true) {
            document.querySelectorAll('.tone-option-button').forEach(btn => btn.classList.toggle('selected', btn.dataset.tone === tone));
            await updateChatSettingsInFirestore({ tone: tone });
            if (showModal) {
                const toneName = uiTexts[currentUILanguage][`tone${tone.charAt(0).toUpperCase() + tone.slice(1)}`] || tone;
                showMessageModal(uiTexts[currentUILanguage].toneSelectedTitle, uiTexts[currentUILanguage].toneSelectedMessage(toneName));
                toneModal.classList.remove('show');
            }
        }
        
        async function setCurrentQMode(qMode, showModal = true) {
            document.querySelectorAll('.q-modes-option-button').forEach(btn => btn.classList.toggle('selected', btn.dataset.qmode === qMode));
            await updateChatSettingsInFirestore({ qMode: qMode });
            if (showModal) {
                const modeName = document.querySelector(`.q-modes-option-button[data-qmode="${qMode}"]`).textContent;
                showMessageModal(uiTexts[currentUILanguage].qModeSelectedTitle, uiTexts[currentUILanguage].qModeSelectedMessage(modeName));
                qModesSelectionModal.classList.remove('show');
            }
            const qModeShortText = qMode === 'quick' ? ` (${uiTexts[currentUILanguage].qModeQuickText.split('(')[1].replace(')','')})` : '';
            document.getElementById('qModesButtonText').textContent = uiTexts[currentUILanguage].qModesButtonText + qModeShortText;
        }

        // --- Theme Toggle Functionality ---
        function applyTheme(theme) {
            const body = document.body;
            const themeToggleIcon = document.querySelector('#themeToggleOption i');
            const statusBarIcon = document.querySelector('#themeToggleStatusBarButton i');
            if (theme === 'light') {
                body.classList.add('light-theme');
                [themeToggleIcon, statusBarIcon].forEach(icon => {
                    icon.classList.remove('fa-moon');
                    icon.classList.add('fa-sun');
                });
            } else {
                body.classList.remove('light-theme');
                [themeToggleIcon, statusBarIcon].forEach(icon => {
                    icon.classList.remove('fa-sun');
                    icon.classList.add('fa-moon');
                });
            }
        }

        async function toggleTheme(event) {
            event.preventDefault();
            const currentTheme = document.body.classList.contains('light-theme') ? 'light' : 'dark';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            applyTheme(newTheme);
            await updateChatSettingsInFirestore({ theme: newTheme });
        }
        
        // --- Utility Functions ---
        function scrollToBottom() { chatMessages.scrollTop = chatMessages.scrollHeight; }
        function scrollToTop() { chatMessages.scrollTop = 0; }
        function showMessageModal(title, content) {
            document.getElementById('messageModalTitle').textContent = title;
            document.getElementById('messageModalContent').textContent = content;
            document.getElementById('messageModalCloseButton').textContent = uiTexts[currentUILanguage].messageModalDefaultButton;
            messageModal.classList.add('show');
        }
        function hideMessageModal() { messageModal.classList.remove('show'); }
        
        function showLoadingIndicator() {
            isLoading = true;
            if (!document.getElementById('loadingIndicator')) {
                appendLoadingIndicator();
            }
        }

        function appendLoadingIndicator() {
            const loadingDiv = document.createElement('div');
            loadingDiv.id = 'loadingIndicator';
            loadingDiv.className = 'loading-indicator';
            // **LOADING INDICATOR FIX**: Replaced with new Quantum Atom animation.
            loadingDiv.innerHTML = `
                <div class="quantum-atom">
                    <div class="electron-path"><div class="electron"></div></div>
                    <div class="electron-path"><div class="electron"></div></div>
                    <div class="electron-path"><div class="electron"></div></div>
                    <div class="nucleus"></div>
                </div>
                <p>${uiTexts[currentUILanguage].qaiTyping}<span class="dots"></span></p>`;
            chatMessages.appendChild(loadingDiv);
            scrollToBottom(); 
        }

        function hideLoadingIndicator() { 
            isLoading = false;
            document.getElementById('loadingIndicator')?.remove(); 
        }
        
        function disableInput() {
            chatUserInput.disabled = true;
            [sendButton, imageAttachButton, qModesButton].forEach(btn => btn.disabled = true);
        }
        function enableInput() {
            chatUserInput.disabled = false;
            [sendButton, imageAttachButton, qModesButton].forEach(btn => btn.disabled = false);
        }

        // --- Web Audio API for Notification Sound ---
        function initializeAudio() {
            if (isAudioInitialized) return;
            try {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                if (audioCtx.state === 'suspended') {
                    audioCtx.resume();
                }
                isAudioInitialized = true;
            } catch (e) {
                console.warn('Web Audio API is not supported in this browser');
            }
        }

        function playNotificationSound() {
            if (!isAudioInitialized) initializeAudio();
            if (!audioCtx || audioCtx.state !== 'running') return;
            
            // **BEEP SOUND FIX**: Increased volume and made it a two-tone beep.
            const now = audioCtx.currentTime;
            const gainNode = audioCtx.createGain();
            gainNode.connect(audioCtx.destination);
            gainNode.gain.setValueAtTime(0.4, now); // Louder volume
            
            const osc1 = audioCtx.createOscillator();
            osc1.type = 'sine';
            osc1.frequency.setValueAtTime(880, now); // First tone
            osc1.connect(gainNode);
            osc1.start(now);
            osc1.stop(now + 0.1);

            const osc2 = audioCtx.createOscillator();
            osc2.type = 'sine';
            osc2.frequency.setValueAtTime(1046.50, now + 0.1); // Second, higher tone
            osc2.connect(gainNode);
            osc2.start(now + 0.1);
            osc2.stop(now + 0.2);

            gainNode.gain.exponentialRampToValueAtTime(0.00001, now + 0.5);
        }
        
        // --- Event Listeners ---
        function addAllEventListeners() {
            sendButton.addEventListener('click', sendMessage);
            chatUserInput.addEventListener('keypress', (event) => {
                 if (event.key === 'Enter' && !event.shiftKey) {
                    event.preventDefault();
                    sendMessage();
                }
            });
            imageAttachButton.addEventListener('click', (e) => { e.preventDefault(); imageFileInput.click(); });
            imageFileInput.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    if (!file.type.startsWith('image/')) {
                        showMessageModal(uiTexts[currentUILanguage].invalidFileTitle, uiTexts[currentUILanguage].invalidFileMessage);
                        imageFileInput.value = '';
                        return;
                    }
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        currentImageUploadData.base64 = e.target.result.split(',')[1];
                        currentImageUploadData.mimeType = file.type;
                        imagePreview.src = e.target.result;
                        imageFileName.textContent = file.name;
                        imagePreviewContainer.classList.remove('hidden');
                        chatUserInput.placeholder = uiTexts[currentUILanguage].photoQueryPlaceholder;
                    };
                    reader.onerror = () => showMessageModal(uiTexts[currentUILanguage].fileReadErrorTitle, uiTexts[currentUILanguage].fileReadErrorMessage);
                    reader.readAsDataURL(file);
                }
            });
            removeImageButton.addEventListener('click', (e) => {
                e.preventDefault();
                currentImageUploadData = { base64: null, mimeType: null };
                imagePreviewContainer.classList.add('hidden');
                imageFileInput.value = '';
                chatUserInput.placeholder = uiTexts[currentUILanguage].inputPlaceholder;
            });
            
            // Sidebar and Modal Toggles
            moreOptionsButton.addEventListener('click', (e) => { e.preventDefault(); moreOptionsSidebar.classList.add('show'); });
            document.getElementById('sidebarCloseButton').addEventListener('click', (e) => { e.preventDefault(); hideMoreOptionsSidebar(); });
            document.getElementById('aboutOption').addEventListener('click', (e) => { e.preventDefault(); aboutModal.classList.add('show'); hideMoreOptionsSidebar(); });
            document.getElementById('responseToneOption').addEventListener('click', (e) => { e.preventDefault(); hideMoreOptionsSidebar(); toneModal.classList.add('show'); });
            qModesButton.addEventListener('click', (e) => { e.preventDefault(); qModesSelectionModal.classList.add('show'); });
            document.getElementById('qModesShortcutStatusBarButton').addEventListener('click', (e) => { e.preventDefault(); qModesSelectionModal.classList.add('show'); });
            document.getElementById('toneShortcutStatusBarButton').addEventListener('click', (e) => { e.preventDefault(); toneModal.classList.add('show'); });

            // Modal Close Buttons
            aboutModal.querySelector('.modal-close-button').addEventListener('click', (e) => { e.preventDefault(); aboutModal.classList.remove('show'); });
            messageModal.querySelector('.modal-close-button').addEventListener('click', (e) => { e.preventDefault(); hideMessageModal(); });
            toneModal.querySelector('.modal-close-button').addEventListener('click', (e) => { e.preventDefault(); toneModal.classList.remove('show'); });
            qModesSelectionModal.querySelector('.modal-close-button').addEventListener('click', (e) => { e.preventDefault(); qModesSelectionModal.classList.remove('show'); });

            // Sidebar Options
            document.getElementById('newChatOption').addEventListener('click', handleNewChat);
            document.getElementById('themeToggleOption').addEventListener('click', toggleTheme);
            document.getElementById('themeToggleStatusBarButton').addEventListener('click', toggleTheme);
            document.getElementById('creativeWritingOption').addEventListener('click', handleCreativeWriting);
            
            // Option Selections (Tone, Q-Mode, Language)
            document.querySelectorAll('.tone-option-button').forEach(button => {
                button.addEventListener('click', (e) => { e.preventDefault(); setSelectedTone(button.dataset.tone); });
            });
            document.querySelectorAll('.q-modes-option-button').forEach(button => {
                button.addEventListener('click', (e) => { e.preventDefault(); setCurrentQMode(button.dataset.qmode); });
            });
            document.querySelector('.language-options-container').addEventListener('click', (event) => {
                if (event.target.classList.contains('language-option')) {
                    event.preventDefault();
                    setAIResponseLanguage(event.target.dataset.lang);
                }
            });

            // Other UI
            scrollToTopArrow.addEventListener('click', (e) => { e.preventDefault(); scrollToTop(); });
            scrollToBottomArrow.addEventListener('click', (e) => { e.preventDefault(); scrollToBottom(); });
            chatMessages.addEventListener('scroll', () => {
                scrollToTopArrow.classList.toggle('show', chatMessages.scrollTop > 100);
                scrollToBottomArrow.classList.toggle('show', chatMessages.scrollHeight - chatMessages.scrollTop - chatMessages.clientHeight > 5 && chatMessages.scrollHeight > chatMessages.clientHeight);
            });
            document.addEventListener('click', (event) => {
                if (moreOptionsSidebar.classList.contains('show') && !moreOptionsSidebar.contains(event.target) && !moreOptionsButton.contains(event.target)) {
                    hideMoreOptionsSidebar();
                }
            });
            document.getElementById('uiLanguageToggleButton').addEventListener('click', (e) => {
                e.preventDefault();
                currentUILanguage = currentUILanguage === 'ur' ? 'en' : 'ur';
                updateUILanguage();
            });
        }
        
        function hideMoreOptionsSidebar() {
            moreOptionsSidebar.classList.remove('show');
        }
        
        function updateUILanguage() {
            const lang = currentUILanguage;
            document.documentElement.lang = lang === 'en' ? 'en' : 'ur';
            document.documentElement.dir = lang === 'en' ? 'ltr' : 'rtl';
            
            // Update all titles and text content
            document.getElementById('themeToggleStatusBarButton').title = uiTexts[lang].themeToggleTitle;
            document.getElementById('qModesShortcutStatusBarButton').title = uiTexts[lang].qModesShortcutTitle;
            document.getElementById('toneShortcutStatusBarButton').title = uiTexts[lang].toneShortcutTitle;
            document.getElementById('uiLanguageToggleButton').textContent = uiTexts[lang].uiLangToggleText;
            document.getElementById('uiLanguageToggleButton').title = lang === 'ur' ? "Switch to English UI" : "UI Ø²Ø¨Ø§Ù† Ø§Ø±Ø¯Ùˆ Ù…ÛŒÚº ØªØ¨Ø¯ÛŒÙ„ Ú©Ø±ÛŒÚº";
            moreOptionsButton.title = uiTexts[lang].moreOptionsTitle;
            
            const sqTitle = document.getElementById('suggestedQuestionsTitle');
            if (sqTitle) sqTitle.textContent = uiTexts[lang].suggestedQuestionsTitle;
            updateSuggestedQuestionButtonText();
            
            document.getElementById('qModesButtonText').textContent = uiTexts[lang].qModesButtonText; // Will be updated by state change
            document.getElementById('imageAttachButtonText').textContent = uiTexts[lang].imageAttachButtonText;
            sendButton.querySelector('span').textContent = uiTexts[lang].sendButtonText;
            chatUserInput.placeholder = currentImageUploadData.base64 ? uiTexts[lang].photoQueryPlaceholder : uiTexts[lang].inputPlaceholder;
            removeImageButton.title = uiTexts[lang].removeImageTitle;
            qModesButton.title = uiTexts[lang].qModesModalTitle;
            imageAttachButton.title = uiTexts[lang].imageAttachButtonText;
            
            // Modals
            document.getElementById('aboutModalTitle').textContent = uiTexts[lang].aboutModalTitle;
            document.getElementById('aboutModalCreator').innerHTML = uiTexts[lang].aboutModalCreator;
            document.getElementById('aboutModalP1').textContent = uiTexts[lang].aboutModalP1;
            document.getElementById('aboutModalP2').textContent = uiTexts[lang].aboutModalP2;
            document.getElementById('aboutModalCloseButton').textContent = uiTexts[lang].modalCloseButton;
            document.getElementById('messageModalCloseButton').textContent = uiTexts[lang].messageModalDefaultButton;
            document.getElementById('toneModalTitle').textContent = uiTexts[lang].toneModalTitle;
            document.querySelectorAll('.tone-option-button').forEach(btn => {
                const toneKey = `tone${btn.dataset.tone.charAt(0).toUpperCase() + btn.dataset.tone.slice(1)}`;
                btn.textContent = uiTexts[lang][toneKey] || btn.dataset.ur;
            });
            document.getElementById('toneModalCloseButton').textContent = uiTexts[lang].modalCloseButton;
            document.getElementById('qModesModalTitle').textContent = uiTexts[lang].qModesModalTitle;
            document.querySelectorAll('.q-modes-option-button').forEach(btn => btn.textContent = btn.dataset[lang] || btn.dataset.ur);
            document.getElementById('qModesModalCloseButton').textContent = uiTexts[lang].modalCloseButton;
            
            // Sidebar
            document.getElementById('sidebarTitle').innerHTML = `<i class="fas fa-cogs"></i> ${uiTexts[lang].sidebarTitle}`;
            document.querySelector('#aboutOption .sidebar-text').textContent = uiTexts[lang].sidebarAbout;
            document.querySelector('#responseLangOptionContainer .sidebar-text').textContent = uiTexts[lang].sidebarResponseLang;
            document.querySelector('#themeToggleOption .sidebar-text').textContent = uiTexts[lang].sidebarThemeToggle;
            document.querySelector('#newChatOption .sidebar-text').textContent = uiTexts[lang].sidebarNewChat;
            document.querySelector('#responseToneOption .sidebar-text').textContent = uiTexts[lang].sidebarResponseTone;
            document.querySelector('#creativeWritingOption .sidebar-text').textContent = uiTexts[lang].sidebarCreativeWriting;
            document.querySelector('#copyChatOption .sidebar-text').textContent = uiTexts[lang].sidebarCopyChat;
            document.querySelector('#exportChatOption .sidebar-text').textContent = uiTexts[lang].sidebarExportChat;
            document.querySelectorAll('#aboutModalList li').forEach(li => li.innerHTML = li.dataset[lang] || li.dataset.ur);
            
            // Other
            document.getElementById('bottomStatusBarText').textContent = uiTexts[lang].bottomStatusBarText;
            scrollToTopArrow.title = uiTexts[lang].scrollToTopTitle;
            scrollToBottomArrow.title = uiTexts[lang].scrollToBottomTitle;
            document.querySelectorAll('.message').forEach(msgDiv => updateUILanguageOnElement(msgDiv));
            const loadingIndicatorP = document.querySelector('#loadingIndicator p');
            if (loadingIndicatorP) loadingIndicatorP.innerHTML = `${uiTexts[lang].qaiTyping}<span class="dots"></span>`;
        }

        function updateSuggestedQuestionButtonText() {
            const lang = currentUILanguage;
            document.querySelectorAll('.suggested-question-button').forEach(button => {
                button.textContent = lang === 'en' ? button.dataset.questionEn : button.dataset.questionUr;
            });
        }

        function updateUILanguageOnElement(element) {
             element.querySelectorAll('.action-text').forEach(span => {
                const parentButton = span.closest('button');
                if (!parentButton) return;
                const isUserMsg = parentButton.closest('.message')?.classList.contains('user-message');
                if (parentButton.classList.contains('copy-button')) span.textContent = isUserMsg ? uiTexts[currentUILanguage].copyQuestionAction : uiTexts[currentUILanguage].copyAction;
                else if (parentButton.classList.contains('speak-button')) span.textContent = uiTexts[currentUILanguage].speakAction;
                else if (parentButton.classList.contains('detail-button')) span.textContent = uiTexts[currentUILanguage].detailAction;
                else if (parentButton.classList.contains('summary-button')) span.textContent = uiTexts[currentUILanguage].summaryAction;
                else if (parentButton.classList.contains('regenerate-button')) span.textContent = uiTexts[currentUILanguage].regenerateAction;
            });
        }
        
        // --- App Initialization ---
        window.onload = () => {
            initializeFirebase();
            addAllEventListeners();
            // User interaction is required to start audio context.
            document.body.addEventListener('click', initializeAudio, { once: true });
            document.body.addEventListener('touchend', initializeAudio, { once: true });
            updateUILanguage();
        };

    </script>

    <script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/sw.js')
        .then(reg => console.log('Service Worker Registered'))
        .catch(err => console.log('Service Worker Error', err));
    });
  }
</script>

</body>
</html>
